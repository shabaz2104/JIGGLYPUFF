<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pharmly ‚Äì Medication Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@400;500;600;700&family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
:root {
  --bg: #0a0f1a;
  --bg2: #0d1421;
  --bg3: #111827;
  --card: #131c2e;
  --card2: #182236;
  --accent: #1bbb7e;
  --accent2: #14a36c;
  --accent-glow: rgba(27,187,126,0.25);
  --accent-glow2: rgba(27,187,126,0.08);
  --blue: #3b82f6;
  --blue-glow: rgba(59,130,246,0.2);
  --yellow: #fbbf24;
  --red: #ef4444;
  --purple: #8b5cf6;
  --text: #e8edf5;
  --text2: #94a3b8;
  --text3: #64748b;
  --border: rgba(255,255,255,0.07);
  --border2: rgba(27,187,126,0.2);
  --font-head: 'Syne', sans-serif;
  --font-body: 'DM Sans', sans-serif;
  --radius: 16px;
  --radius-sm: 10px;
  --transition: 0.3s cubic-bezier(0.4,0,0.2,1);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);overflow-x:hidden;}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:var(--bg2);}
::-webkit-scrollbar-thumb{background:var(--card2);border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:var(--accent);}

/* ===== GLOBAL NAV ===== */
.global-nav {
  position:fixed;top:0;left:0;right:0;z-index:1000;
  height:64px;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 40px;
  background:rgba(10,15,26,0.85);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}
.nav-logo {
  display:flex;align-items:center;gap:10px;cursor:pointer;
  font-family:var(--font-head);font-size:22px;font-weight:800;
  color:var(--text);
  transition:var(--transition);
}
.nav-logo:hover{color:var(--accent);}
.nav-logo .logo-icon {
  width:36px;height:36px;background:var(--accent);border-radius:10px;
  display:flex;align-items:center;justify-content:center;font-size:18px;
  font-weight:900;color:#0a0f1a;
  box-shadow:0 0 20px var(--accent-glow);
}
.nav-links {display:flex;align-items:center;gap:8px;}
.nav-link {
  padding:8px 16px;border-radius:8px;font-size:14px;font-weight:500;
  color:var(--text2);cursor:pointer;transition:var(--transition);
  border:1px solid transparent;
  font-family:var(--font-body);
}
.nav-link:hover,.nav-link.active{color:var(--text);background:var(--card);border-color:var(--border);}
.nav-right{display:flex;align-items:center;gap:12px;}
.btn-login {
  padding:9px 22px;border-radius:10px;font-size:14px;font-weight:600;
  background:var(--accent);color:#0a0f1a;cursor:pointer;
  border:none;transition:var(--transition);font-family:var(--font-body);
  box-shadow:0 0 20px var(--accent-glow);
}
.btn-login:hover{background:var(--accent2);box-shadow:0 0 30px rgba(27,187,126,0.4);}

/* ===== PAGES ===== */
.page{display:none;min-height:100vh;}
.page.active{display:block;}

/* ===== LANDING PAGE ===== */
#page-home {
  background:var(--bg);
  position:relative;overflow:hidden;
}
.landing-hero {
  min-height:100vh;display:flex;flex-direction:column;
  align-items:center;justify-content:center;text-align:center;
  padding:120px 40px 80px;position:relative;
}
/* Animated BG grid */
.bg-grid {
  position:fixed;top:0;left:0;width:100%;height:100%;
  pointer-events:none;z-index:0;
  background-image:
    linear-gradient(rgba(27,187,126,0.04) 1px,transparent 1px),
    linear-gradient(90deg,rgba(27,187,126,0.04) 1px,transparent 1px);
  background-size:60px 60px;
  animation:gridMove 20s linear infinite;
}
@keyframes gridMove{from{background-position:0 0;}to{background-position:60px 60px;}}
.bg-orb {
  position:fixed;border-radius:50%;pointer-events:none;z-index:0;
  filter:blur(80px);
}
.orb1{width:600px;height:600px;background:radial-gradient(circle,rgba(27,187,126,0.12) 0%,transparent 70%);top:-200px;right:-100px;animation:orbFloat 8s ease-in-out infinite;}
.orb2{width:400px;height:400px;background:radial-gradient(circle,rgba(59,130,246,0.1) 0%,transparent 70%);bottom:-100px;left:-100px;animation:orbFloat 10s ease-in-out infinite reverse;}
.orb3{width:300px;height:300px;background:radial-gradient(circle,rgba(139,92,246,0.08) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation:orbFloat 12s ease-in-out infinite 2s;}
@keyframes orbFloat{0%,100%{transform:translateY(0) scale(1);}50%{transform:translateY(-30px) scale(1.05);}}

.hero-badge {
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 16px;border-radius:100px;
  background:rgba(27,187,126,0.1);border:1px solid rgba(27,187,126,0.3);
  font-size:13px;color:var(--accent);font-weight:600;
  margin-bottom:32px;
  animation:fadeInUp 0.8s ease both;
}
.hero-badge::before{content:'';width:6px;height:6px;background:var(--accent);border-radius:50%;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.4;}}

.hero-title {
  font-family:var(--font-head);font-size:clamp(48px,7vw,90px);font-weight:800;
  line-height:1.05;letter-spacing:-2px;margin-bottom:24px;
  position:relative;z-index:1;
  animation:fadeInUp 0.8s ease 0.1s both;
}
.hero-title .glow-word {
  color:var(--accent);
  text-shadow:0 0 40px rgba(27,187,126,0.5),0 0 80px rgba(27,187,126,0.2);
}
.hero-subtitle {
  font-size:18px;color:var(--text2);max-width:600px;line-height:1.7;
  margin-bottom:48px;position:relative;z-index:1;
  animation:fadeInUp 0.8s ease 0.2s both;
}
.hero-actions {
  display:flex;align-items:center;gap:16px;flex-wrap:wrap;justify-content:center;
  position:relative;z-index:1;
  animation:fadeInUp 0.8s ease 0.3s both;
}
.btn-primary {
  padding:16px 40px;border-radius:12px;font-size:16px;font-weight:700;
  background:var(--accent);color:#0a0f1a;cursor:pointer;border:none;
  transition:var(--transition);font-family:var(--font-body);
  box-shadow:0 0 40px rgba(27,187,126,0.4);
  letter-spacing:0.5px;
}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 50px rgba(27,187,126,0.5);}
.btn-secondary {
  padding:16px 40px;border-radius:12px;font-size:16px;font-weight:600;
  background:var(--card);color:var(--text);cursor:pointer;
  border:1px solid var(--border);transition:var(--transition);font-family:var(--font-body);
}
.btn-secondary:hover{border-color:var(--accent);color:var(--accent);}

/* Stats row */
.hero-stats {
  display:flex;gap:48px;margin-top:80px;position:relative;z-index:1;
  animation:fadeInUp 0.8s ease 0.4s both;
  flex-wrap:wrap;justify-content:center;
}
.stat-item{text-align:center;}
.stat-num{font-family:var(--font-head);font-size:36px;font-weight:800;color:var(--accent);}
.stat-label{font-size:13px;color:var(--text3);margin-top:4px;}

/* Features section */
.section {
  padding:100px 40px;max-width:1200px;margin:0 auto;
  position:relative;z-index:1;
}
.section-badge {
  display:inline-block;padding:6px 14px;border-radius:100px;
  background:rgba(27,187,126,0.1);border:1px solid rgba(27,187,126,0.25);
  font-size:12px;font-weight:700;color:var(--accent);letter-spacing:1px;
  text-transform:uppercase;margin-bottom:20px;
}
.section-title {
  font-family:var(--font-head);font-size:clamp(32px,4vw,52px);font-weight:800;
  margin-bottom:16px;line-height:1.1;
}
.section-sub{font-size:17px;color:var(--text2);max-width:560px;line-height:1.7;}
.features-grid {
  display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:24px;
  margin-top:60px;
}
.feature-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:32px;transition:var(--transition);cursor:pointer;position:relative;overflow:hidden;
}
.feature-card::before {
  content:'';position:absolute;inset:0;border-radius:inherit;
  background:linear-gradient(135deg,rgba(27,187,126,0.05),transparent);
  opacity:0;transition:var(--transition);
}
.feature-card:hover{border-color:var(--border2);transform:translateY(-4px);}
.feature-card:hover::before{opacity:1;}
.feature-icon {
  width:52px;height:52px;border-radius:14px;
  background:rgba(27,187,126,0.12);border:1px solid rgba(27,187,126,0.2);
  display:flex;align-items:center;justify-content:center;font-size:24px;
  margin-bottom:20px;
}
.feature-card h3{font-family:var(--font-head);font-size:20px;font-weight:700;margin-bottom:10px;}
.feature-card p{font-size:14px;color:var(--text2);line-height:1.7;}

/* About section */
.about-grid {
  display:grid;grid-template-columns:1fr 1fr;gap:60px;align-items:center;margin-top:60px;
}
.about-visual {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:40px;position:relative;overflow:hidden;
}
.about-visual::after {
  content:'';position:absolute;top:-50%;right:-50%;width:300px;height:300px;
  background:radial-gradient(circle,rgba(27,187,126,0.1) 0%,transparent 70%);
  pointer-events:none;
}
.about-stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
.about-stat {
  background:var(--card2);border-radius:var(--radius-sm);padding:20px;
  border:1px solid var(--border);
}
.about-stat .num{font-family:var(--font-head);font-size:32px;font-weight:800;color:var(--accent);}
.about-stat .lbl{font-size:12px;color:var(--text3);margin-top:4px;}

/* Safety section */
.safety-grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-top:60px;}
.safety-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:28px;
  position:relative;overflow:hidden;transition:var(--transition);
}
.safety-card:hover{border-color:rgba(59,130,246,0.3);}
.safety-icon {
  width:44px;height:44px;border-radius:12px;
  background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.2);
  display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:16px;
}
.safety-card h4{font-size:16px;font-weight:700;margin-bottom:8px;}
.safety-card p{font-size:13px;color:var(--text2);line-height:1.6;}

@keyframes fadeInUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}

/* Scroll reveal */
.reveal{opacity:0;transform:translateY(40px);transition:opacity 0.7s ease,transform 0.7s ease;}
.reveal.visible{opacity:1;transform:translateY(0);}

/* ===== LOGIN MODAL ===== */
.modal-overlay {
  position:fixed;inset:0;z-index:9999;
  background:rgba(0,0,0,0.7);backdrop-filter:blur(8px);
  display:none;align-items:center;justify-content:center;
}
.modal-overlay.open{display:flex;}
.modal {
  background:var(--card);border:1px solid var(--border);
  border-radius:20px;padding:48px;width:100%;max-width:440px;
  position:relative;
  box-shadow:0 40px 100px rgba(0,0,0,0.5),0 0 0 1px var(--border);
  animation:modalIn 0.3s ease;
}
@keyframes modalIn{from{opacity:0;transform:scale(0.95)translateY(20px);}to{opacity:1;transform:none;}}
.modal-close {
  position:absolute;top:20px;right:20px;width:32px;height:32px;
  background:var(--card2);border:1px solid var(--border);border-radius:8px;
  display:flex;align-items:center;justify-content:center;cursor:pointer;
  font-size:16px;color:var(--text2);transition:var(--transition);
}
.modal-close:hover{color:var(--text);background:var(--bg3);}
.modal-title {font-family:var(--font-head);font-size:26px;font-weight:800;margin-bottom:6px;}
.modal-sub{font-size:14px;color:var(--text2);margin-bottom:32px;}
.form-group{margin-bottom:20px;}
.form-label{display:block;font-size:13px;font-weight:600;color:var(--text2);margin-bottom:8px;letter-spacing:0.5px;}
.form-input {
  width:100%;padding:13px 16px;border-radius:10px;
  background:var(--bg3);border:1px solid var(--border);
  color:var(--text);font-size:15px;font-family:var(--font-body);
  outline:none;transition:var(--transition);
}
.form-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(27,187,126,0.1);}
.form-error{font-size:12px;color:var(--red);margin-top:6px;display:none;}
.btn-block {
  width:100%;padding:14px;border-radius:12px;font-size:16px;font-weight:700;
  background:var(--accent);color:#0a0f1a;cursor:pointer;border:none;
  transition:var(--transition);font-family:var(--font-body);
  box-shadow:0 0 30px var(--accent-glow);
  margin-top:8px;
}
.btn-block:hover{background:var(--accent2);transform:translateY(-1px);}

/* ===== AI + ADMIN DASHBOARD PAGE ===== */
#page-dashboard {
  padding-top:64px;
  display:none;
}
#page-dashboard.active{display:flex;flex-direction:column;}
.dashboard-layout {
  display:grid;grid-template-columns:1fr 1fr;
  min-height:calc(100vh - 64px);
  gap:0;
}

/* AI Chat Panel */
.ai-panel {
  background:linear-gradient(160deg,#0d2340 0%,#0a1628 50%,#061020 100%);
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;
  position:relative;overflow:hidden;
}
.ai-panel::before {
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,var(--accent),var(--blue),var(--accent));
}
.ai-header {
  padding:24px;border-bottom:1px solid rgba(255,255,255,0.06);
  display:flex;align-items:center;justify-content:space-between;
  background:rgba(255,255,255,0.02);
}
.ai-header-left{display:flex;align-items:center;gap:14px;}
.ai-avatar {
  width:44px;height:44px;border-radius:12px;
  background:linear-gradient(135deg,var(--blue),#60a5fa);
  display:flex;align-items:center;justify-content:center;font-size:22px;
  box-shadow:0 0 20px rgba(59,130,246,0.3);
}
.ai-title-block h2{font-family:var(--font-head);font-size:17px;font-weight:700;}
.ai-title-block p{font-size:12px;color:var(--text3);margin-top:2px;}
.status-dot {
  display:flex;align-items:center;gap:6px;font-size:12px;color:var(--accent);
  background:rgba(27,187,126,0.1);border:1px solid rgba(27,187,126,0.2);
  padding:5px 12px;border-radius:100px;
}
.status-dot::before{content:'';width:6px;height:6px;background:var(--accent);border-radius:50%;animation:pulse 2s infinite;}

.btn-call {
  display:flex;align-items:center;gap:8px;
  padding:10px 18px;border-radius:10px;
  background:linear-gradient(135deg,var(--accent),#14a36c);
  color:#0a0f1a;font-weight:700;font-size:13px;cursor:pointer;border:none;
  transition:var(--transition);font-family:var(--font-body);
  box-shadow:0 0 20px var(--accent-glow);
}
.btn-call:hover{transform:translateY(-1px);box-shadow:0 4px 25px rgba(27,187,126,0.4);}
.btn-call.calling{background:linear-gradient(135deg,var(--red),#dc2626);color:white;animation:callPulse 1s infinite;}
@keyframes callPulse{0%,100%{box-shadow:0 0 20px rgba(239,68,68,0.4);}50%{box-shadow:0 0 40px rgba(239,68,68,0.7);}}

.chat-messages {
  flex:1;overflow-y:auto;padding:24px;
  display:flex;flex-direction:column;gap:16px;
}
.msg {display:flex;gap:12px;animation:fadeInUp 0.3s ease;}
.msg.user{flex-direction:row-reverse;}
.msg-avatar {
  width:36px;height:36px;border-radius:10px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;font-size:16px;
}
.msg.ai .msg-avatar{background:linear-gradient(135deg,var(--blue),#60a5fa);box-shadow:0 0 15px rgba(59,130,246,0.3);}
.msg.user .msg-avatar{background:linear-gradient(135deg,var(--accent),#14a36c);}
.msg-bubble {
  max-width:75%;padding:14px 18px;border-radius:16px;font-size:14px;line-height:1.6;
}
.msg.ai .msg-bubble {
  background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);
  border-radius:4px 16px 16px 16px;
}
.msg.user .msg-bubble {
  background:linear-gradient(135deg,var(--blue),#2563eb);
  border-radius:16px 4px 16px 16px;color:white;
}
.msg-info{display:flex;align-items:center;gap:8px;margin-top:8px;}
.msg-notify {
  display:flex;align-items:center;gap:6px;font-size:11px;color:var(--accent);
  background:rgba(27,187,126,0.08);padding:5px 10px;border-radius:8px;
}
.msg-time{font-size:11px;color:var(--text3);}
.typing-indicator {
  display:flex;align-items:center;gap:5px;padding:14px 18px;
  background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.08);
  border-radius:4px 16px 16px 16px;width:fit-content;display:none;
}
.typing-dot{width:7px;height:7px;background:var(--text3);border-radius:50%;animation:typingBounce 1.4s infinite;}
.typing-dot:nth-child(2){animation-delay:0.2s;}
.typing-dot:nth-child(3){animation-delay:0.4s;}
@keyframes typingBounce{0%,60%,100%{transform:translateY(0);}30%{transform:translateY(-8px);}}

.chat-input-area {
  padding:20px;border-top:1px solid rgba(255,255,255,0.06);
  background:rgba(0,0,0,0.2);
}
.chat-input-row {
  display:flex;align-items:center;gap:10px;
  background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);
  border-radius:12px;padding:8px 12px;
  transition:var(--transition);
}
.chat-input-row:focus-within{border-color:rgba(59,130,246,0.4);}
.chat-input {
  flex:1;background:none;border:none;outline:none;
  color:var(--text);font-size:14px;font-family:var(--font-body);
  padding:6px;
}
.chat-input::placeholder{color:var(--text3);}
.btn-send {
  width:38px;height:38px;border-radius:9px;
  background:linear-gradient(135deg,var(--blue),#2563eb);
  border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:16px;transition:var(--transition);flex-shrink:0;
}
.btn-send:hover{transform:scale(1.05);}

/* Admin Dashboard Right Panel */
.admin-panel {
  background:var(--bg2);overflow-y:auto;
  display:flex;flex-direction:column;
}
.admin-header {
  padding:24px 28px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:var(--card);position:sticky;top:0;z-index:10;
}
.admin-header h2{font-family:var(--font-head);font-size:20px;font-weight:800;}
.admin-sub{font-size:13px;color:var(--text3);margin-top:2px;}
.admin-content{padding:24px;display:flex;flex-direction:column;gap:20px;}

/* Admin cards */
.mini-cards-row {display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.mini-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius-sm);
  padding:18px;transition:var(--transition);
}
.mini-card:hover{border-color:var(--border2);transform:translateY(-2px);}
.mini-card-label{font-size:11px;color:var(--text3);font-weight:600;letter-spacing:0.5px;text-transform:uppercase;margin-bottom:8px;}
.mini-card-val{font-family:var(--font-head);font-size:22px;font-weight:800;}
.mini-card-change{font-size:11px;color:var(--accent);margin-top:4px;display:flex;align-items:center;gap:3px;}

/* Alert cards */
.alert-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius-sm);
  padding:16px;
}
.alert-title {font-size:13px;font-weight:700;color:var(--text2);margin-bottom:12px;display:flex;align-items:center;gap:8px;}
.alert-item {
  display:flex;align-items:center;justify-content:space-between;
  padding:9px 12px;border-radius:8px;margin-bottom:8px;
  font-size:13px;
}
.alert-item.low{background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.15);}
.alert-item.warn{background:rgba(251,191,36,0.08);border:1px solid rgba(251,191,36,0.15);}
.badge {
  font-size:11px;font-weight:700;padding:3px 9px;border-radius:100px;
}
.badge.red{background:rgba(239,68,68,0.15);color:var(--red);}
.badge.yellow{background:rgba(251,191,36,0.15);color:var(--yellow);}
.badge.green{background:rgba(27,187,126,0.15);color:var(--accent);}
.badge.blue{background:rgba(59,130,246,0.15);color:var(--blue);}

/* Inventory table in admin panel */
.inv-table {width:100%;border-collapse:collapse;font-size:13px;}
.inv-table th{text-align:left;padding:10px 12px;color:var(--text3);font-size:11px;font-weight:600;letter-spacing:0.5px;text-transform:uppercase;border-bottom:1px solid var(--border);}
.inv-table td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.03);}
.inv-table tr:hover td{background:rgba(255,255,255,0.02);}

/* Recent orders */
.order-item {
  display:flex;align-items:center;justify-content:space-between;
  padding:12px;background:rgba(255,255,255,0.02);border-radius:10px;
  border:1px solid var(--border);margin-bottom:8px;
  transition:var(--transition);
}
.order-item:hover{border-color:var(--border2);background:rgba(27,187,126,0.03);}
.order-id{font-size:12px;font-weight:700;color:var(--blue);}
.order-name{font-size:13px;font-weight:500;margin-top:2px;}
.order-pills{font-size:12px;color:var(--text3);}

/* Pending refill */
.refill-row {
  display:flex;align-items:center;gap:12px;padding:10px;
  border-radius:8px;background:rgba(255,255,255,0.02);
  border:1px solid var(--border);margin-bottom:6px;font-size:13px;
}
.refill-row .req-id{font-weight:700;color:var(--purple);font-size:12px;min-width:70px;}

/* ===== ADMIN FULL PAGE ===== */
#page-admin {
  padding-top:64px;
  display:none;min-height:100vh;
  background:var(--bg);
}
#page-admin.active{display:flex;}
.admin-sidebar {
  width:220px;flex-shrink:0;background:var(--card);border-right:1px solid var(--border);
  height:calc(100vh - 64px);position:sticky;top:64px;overflow-y:auto;
  padding:20px 12px;display:flex;flex-direction:column;
}
.sidebar-section{margin-bottom:24px;}
.sidebar-section-label {
  font-size:10px;font-weight:700;color:var(--text3);letter-spacing:1.5px;
  text-transform:uppercase;padding:0 12px;margin-bottom:8px;
}
.sidebar-item {
  display:flex;align-items:center;gap:10px;padding:10px 12px;
  border-radius:10px;font-size:14px;font-weight:500;color:var(--text2);
  cursor:pointer;transition:var(--transition);margin-bottom:2px;
}
.sidebar-item:hover{color:var(--text);background:var(--card2);}
.sidebar-item.active{color:var(--accent);background:rgba(27,187,126,0.1);border:1px solid rgba(27,187,126,0.15);}
.sidebar-item .sidebar-icon{font-size:18px;width:24px;text-align:center;}
.sidebar-badge {
  margin-left:auto;font-size:11px;font-weight:700;padding:2px 8px;
  background:rgba(239,68,68,0.15);color:var(--red);border-radius:100px;
}

.admin-main {
  flex:1;overflow-y:auto;height:calc(100vh - 64px);
}
.admin-topbar {
  padding:20px 32px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:var(--card);position:sticky;top:0;z-index:10;
}
.admin-page-title {font-family:var(--font-head);font-size:22px;font-weight:800;}
.search-bar {
  display:flex;align-items:center;gap:10px;
  background:var(--bg3);border:1px solid var(--border);border-radius:10px;
  padding:9px 16px;width:280px;transition:var(--transition);
}
.search-bar:focus-within{border-color:var(--accent);box-shadow:0 0 0 3px rgba(27,187,126,0.1);}
.search-bar input {
  background:none;border:none;outline:none;
  color:var(--text);font-size:14px;font-family:var(--font-body);flex:1;
}
.search-bar input::placeholder{color:var(--text3);}
.search-result-panel {
  position:absolute;top:100%;left:0;right:0;
  background:var(--card);border:1px solid var(--border);border-radius:12px;
  margin-top:8px;padding:12px;
  max-height:300px;overflow-y:auto;z-index:100;display:none;
  box-shadow:0 20px 60px rgba(0,0,0,0.4);
}
.search-result-item {
  padding:12px;border-radius:8px;cursor:pointer;transition:var(--transition);
  border-bottom:1px solid var(--border);
}
.search-result-item:last-child{border-bottom:none;}
.search-result-item:hover{background:rgba(27,187,126,0.05);}
.search-result-item .med-name{font-size:14px;font-weight:600;}
.search-result-item .med-details{font-size:12px;color:var(--text2);margin-top:4px;}
.search-result-item .stock-badge{float:right;margin-top:2px;}
.search-wrapper{position:relative;}

.admin-body{padding:32px;}
.section-head {
  display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;
}
.section-head h3 {font-family:var(--font-head);font-size:20px;font-weight:800;}

/* Stats grid */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:32px;}
.stat-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:24px;transition:var(--transition);position:relative;overflow:hidden;
}
.stat-card::before {
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
}
.stat-card.green::before{background:linear-gradient(90deg,var(--accent),transparent);}
.stat-card.blue::before{background:linear-gradient(90deg,var(--blue),transparent);}
.stat-card.yellow::before{background:linear-gradient(90deg,var(--yellow),transparent);}
.stat-card.purple::before{background:linear-gradient(90deg,var(--purple),transparent);}
.stat-card:hover{border-color:var(--border2);transform:translateY(-3px);}
.stat-card .lbl{font-size:12px;color:var(--text3);font-weight:600;letter-spacing:0.5px;text-transform:uppercase;margin-bottom:10px;}
.stat-card .val{font-family:var(--font-head);font-size:28px;font-weight:800;margin-bottom:8px;}
.stat-card .chg{font-size:12px;display:flex;align-items:center;gap:4px;}
.stat-card .chg.up{color:var(--accent);}
.stat-card .chg.down{color:var(--red);}

/* Charts */
.charts-grid{display:grid;grid-template-columns:2fr 1fr;gap:24px;margin-bottom:32px;}
.chart-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:24px;
}
.chart-card h4{font-family:var(--font-head);font-size:16px;font-weight:700;margin-bottom:4px;}
.chart-card .chart-sub{font-size:12px;color:var(--text3);margin-bottom:20px;}
.chart-container{position:relative;height:200px;}

/* Top products */
.top-product-item {
  display:flex;align-items:center;gap:14px;padding:12px;
  border-radius:10px;transition:var(--transition);margin-bottom:6px;
}
.top-product-item:hover{background:rgba(255,255,255,0.03);}
.product-rank {
  width:28px;height:28px;border-radius:8px;background:var(--card2);
  display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;
  color:var(--text3);flex-shrink:0;
}
.product-rank.gold{background:rgba(251,191,36,0.15);color:var(--yellow);}
.product-rank.silver{background:rgba(148,163,184,0.1);color:#94a3b8;}
.product-rank.bronze{background:rgba(205,127,50,0.1);color:#cd7f32;}
.product-info{flex:1;min-width:0;}
.product-info .pname{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.product-info .psold{font-size:11px;color:var(--text3);margin-top:2px;}
.product-price{font-size:14px;font-weight:700;color:var(--accent);}

/* Data table */
.data-table {width:100%;border-collapse:collapse;}
.data-table th {
  text-align:left;padding:12px 16px;font-size:11px;font-weight:700;
  color:var(--text3);letter-spacing:0.8px;text-transform:uppercase;
  border-bottom:1px solid var(--border);background:rgba(255,255,255,0.01);
}
.data-table td{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,0.03);font-size:14px;}
.data-table tr:hover td{background:rgba(255,255,255,0.02);}
.data-table .td-id{font-family:monospace;color:var(--blue);font-size:12px;}
.data-table .td-name{font-weight:500;}
.data-table .td-price{font-weight:700;color:var(--accent);}

.table-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  overflow:hidden;margin-bottom:32px;
}
.table-card-header {
  padding:20px 24px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.table-card-header h4{font-family:var(--font-head);font-size:17px;font-weight:700;}
.table-wrapper{overflow-x:auto;max-height:400px;overflow-y:auto;}

/* Stock indicator */
.stock-bar-wrap{display:flex;align-items:center;gap:8px;}
.stock-bar-bg{flex:1;height:5px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;max-width:80px;}
.stock-bar-fill{height:100%;border-radius:3px;transition:width 0.5s ease;}
.stock-bar-fill.high{background:var(--accent);}
.stock-bar-fill.medium{background:var(--yellow);}
.stock-bar-fill.low{background:var(--red);}
.stock-num{font-size:12px;font-weight:700;min-width:30px;}

/* Heatmap orders by time */
.heatmap-grid {
  display:grid;grid-template-columns:repeat(7,1fr);gap:4px;
  padding:16px 0;
}
.heatmap-cell {
  aspect-ratio:1;border-radius:4px;background:rgba(27,187,126,0.05);
  transition:var(--transition);cursor:pointer;
  display:flex;align-items:center;justify-content:center;font-size:9px;color:transparent;
}
.heatmap-cell:hover{color:var(--text);transform:scale(1.2);}
.heatmap-cell.h1{background:rgba(27,187,126,0.15);}
.heatmap-cell.h2{background:rgba(27,187,126,0.3);}
.heatmap-cell.h3{background:rgba(27,187,126,0.5);}
.heatmap-cell.h4{background:rgba(27,187,126,0.75);}
.heatmap-cell.h5{background:var(--accent);}
.heatmap-labels{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:4px;}
.hm-label{font-size:10px;color:var(--text3);text-align:center;}

/* Customer page */
.customer-grid {display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:24px;}
.customer-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:20px;transition:var(--transition);cursor:pointer;
}
.customer-card:hover{border-color:var(--border2);transform:translateY(-2px);}
.cust-avatar {
  width:44px;height:44px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:800;
  color:white;margin-bottom:14px;
}
.cust-id{font-size:11px;color:var(--text3);margin-bottom:4px;}
.cust-name{font-size:15px;font-weight:700;margin-bottom:2px;}
.cust-meta{font-size:12px;color:var(--text2);}
.cust-product{font-size:12px;color:var(--text3);margin-top:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cust-footer{display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);}
.cust-price{font-size:15px;font-weight:700;color:var(--accent);}
.cust-date{font-size:11px;color:var(--text3);}

/* Stock level page */
.stock-grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;}
.stock-card {
  background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
  padding:20px;transition:var(--transition);
}
.stock-card:hover{transform:translateY(-2px);}
.stock-card.low-stock{border-color:rgba(239,68,68,0.3);}
.stock-card.high-stock{border-color:rgba(27,187,126,0.2);}
.stock-card-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px;}
.stock-name{font-size:14px;font-weight:600;line-height:1.4;flex:1;padding-right:10px;}
.stock-qty {
  font-family:var(--font-head);font-size:28px;font-weight:800;margin-bottom:4px;
}
.stock-qty.qty-low{color:var(--red);}
.stock-qty.qty-med{color:var(--yellow);}
.stock-qty.qty-high{color:var(--accent);}
.stock-size{font-size:12px;color:var(--text3);}
.stock-input-row {
  display:flex;gap:8px;margin-top:12px;
}
.stock-input {
  flex:1;padding:7px 10px;border-radius:8px;
  background:var(--bg3);border:1px solid var(--border);
  color:var(--text);font-size:13px;font-family:var(--font-body);outline:none;
}
.stock-input:focus{border-color:var(--accent);}
.btn-stock-update {
  padding:7px 14px;border-radius:8px;background:var(--accent);
  color:#0a0f1a;font-size:12px;font-weight:700;cursor:pointer;border:none;
  transition:var(--transition);
}
.btn-stock-update:hover{background:var(--accent2);}

/* Pill tabs */
.pill-tabs{display:flex;gap:6px;margin-bottom:24px;}
.pill-tab {
  padding:8px 18px;border-radius:100px;font-size:13px;font-weight:600;
  cursor:pointer;transition:var(--transition);
  background:var(--card);border:1px solid var(--border);color:var(--text2);
}
.pill-tab.active,.pill-tab:hover{background:var(--accent);color:#0a0f1a;border-color:var(--accent);}

/* Admin sub pages */
.admin-subpage{display:none;}
.admin-subpage.active{display:block;}

/* Notification toast */
.toast {
  position:fixed;bottom:24px;right:24px;z-index:9998;
  background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:16px 20px;display:flex;align-items:center;gap:12px;
  font-size:14px;min-width:280px;max-width:360px;
  box-shadow:0 20px 60px rgba(0,0,0,0.4);
  transform:translateY(20px);opacity:0;transition:var(--transition);
  pointer-events:none;
}
.toast.show{transform:translateY(0);opacity:1;pointer-events:all;}
.toast-icon{font-size:20px;flex-shrink:0;}

/* Responsive */
@media(max-width:900px){
  .dashboard-layout{grid-template-columns:1fr;}
  .stats-grid{grid-template-columns:repeat(2,1fr);}
  .charts-grid{grid-template-columns:1fr;}
  .customer-grid{grid-template-columns:repeat(2,1fr);}
  .about-grid{grid-template-columns:1fr;}
  .admin-sidebar{width:60px;}
  .sidebar-item span{display:none;}
  .sidebar-section-label{display:none;}
}

/* Glow animations for cards on scroll */
.glow-on-scroll {
  transition:box-shadow 0.5s ease,border-color 0.5s ease;
}
.glow-on-scroll.glowing {
  border-color:var(--border2)!important;
  box-shadow:0 0 30px var(--accent-glow2);
}
</style>
</head>
<body>

<!-- BG effects (persistent) -->
<div class="bg-grid"></div>
<div class="bg-orb orb1"></div>
<div class="bg-orb orb2"></div>
<div class="bg-orb orb3"></div>

<!-- ===== GLOBAL NAV ===== -->
<nav class="global-nav" id="globalNav">
  <div class="nav-logo" onclick="showPage('home')">
    <div class="logo-icon">P</div>
    Pharmly
  </div>
  <div class="nav-links">
    <div class="nav-link active" onclick="navTo('home',this)">üè† Home</div>
    <div class="nav-link" onclick="navTo('dashboard',this)">ü§ñ AI Assistant</div>
    <div class="nav-link" onclick="navTo('admin',this)">üìä Admin Panel</div>
    <div class="nav-link" onclick="scrollToSection('about')">‚ÑπÔ∏è About</div>
    <div class="nav-link" onclick="scrollToSection('safety')">üõ°Ô∏è Safety</div>
  </div>
  <div class="nav-right">
    <button class="btn-login" onclick="openLogin()">üîë Admin Login</button>
  </div>
</nav>

<!-- ===== LOGIN MODAL ===== -->
<div class="modal-overlay" id="loginModal">
  <div class="modal">
    <div class="modal-close" onclick="closeLogin()">‚úï</div>
    <div class="modal-title">Welcome back</div>
    <div class="modal-sub">Sign in to access the admin dashboard</div>
    <div class="form-group">
      <label class="form-label">USERNAME</label>
      <input class="form-input" type="text" id="loginUser" placeholder="Enter username" autocomplete="off">
    </div>
    <div class="form-group">
      <label class="form-label">EMAIL ADDRESS</label>
      <input class="form-input" type="email" id="loginEmail" placeholder="admin@pharmly.com">
    </div>
    <div class="form-group">
      <label class="form-label">PASSWORD</label>
      <input class="form-input" type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <div class="form-error" id="loginError">‚ùå Invalid credentials. Try admin / admin@pharmly.com / admin123</div>
    </div>
    <button class="btn-block" onclick="doLogin()">Sign In ‚Üí</button>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <span class="toast-icon" id="toastIcon">‚úÖ</span>
  <span id="toastMsg">Action completed!</span>
</div>

<!-- ===== PAGE: HOME ===== -->
<div id="page-home" class="page active">

  <!-- HERO -->
  <section class="landing-hero">
    <div class="hero-badge">üü¢ Live System ‚Äî Powered by AI</div>
    <h1 class="hero-title">
      Smart Pharmacy<br>
      <span class="glow-word">Management</span><br>
      Reimagined
    </h1>
    <p class="hero-subtitle">
      An AI-powered medication management system with real-time inventory tracking, intelligent order processing, and smart analytics ‚Äî all in one dashboard.
    </p>
    <div class="hero-actions">
      <button class="btn-primary" onclick="showPage('dashboard')">üöÄ Get Started</button>
      <button class="btn-secondary" onclick="navTo('admin')">üìä View Admin Panel</button>
    </div>
    <div class="hero-stats">
      <div class="stat-item">
        <div class="stat-num">52</div>
        <div class="stat-label">Products Listed</div>
      </div>
      <div class="stat-item">
        <div class="stat-num">51</div>
        <div class="stat-label">Patient Records</div>
      </div>
      <div class="stat-item">
        <div class="stat-num">99.9%</div>
        <div class="stat-label">Uptime</div>
      </div>
      <div class="stat-item">
        <div class="stat-num">AI</div>
        <div class="stat-label">Powered Assistant</div>
      </div>
    </div>
  </section>

  <!-- FEATURES -->
  <section class="section reveal" id="features">
    <div class="section-badge">FEATURES</div>
    <h2 class="section-title">Everything you need to<br>run a smart pharmacy</h2>
    <p class="section-sub">From AI-powered ordering to real-time inventory ‚Äî Pharmly has it all built in.</p>
    <div class="features-grid">
      <div class="feature-card reveal glow-on-scroll">
        <div class="feature-icon">ü§ñ</div>
        <h3>AI Medication Assistant</h3>
        <p>Chat with our intelligent AI to place orders, check stock, and get medication information instantly. Voice and text support included.</p>
      </div>
      <div class="feature-card reveal glow-on-scroll">
        <div class="feature-icon">üì¶</div>
        <h3>Real-time Inventory</h3>
        <p>Track every medicine in stock with live updates. Instant alerts for low stock and automatic refill request generation.</p>
      </div>
      <div class="feature-card reveal glow-on-scroll">
        <div class="feature-icon">üìä</div>
        <h3>Advanced Analytics</h3>
        <p>Beautiful charts and graphs for sales, orders, top products, and revenue. Interactive data that updates in real time.</p>
      </div>
      <div class="feature-card reveal glow-on-scroll">
        <div class="feature-icon">üë•</div>
        <h3>Patient Management</h3>
        <p>Full customer database with purchase history, demographics, dosage info, and prescription requirements.</p>
      </div>
      <div class="feature-card reveal glow-on-scroll">
        <div class="feature-icon">üìû</div>
        <h3>Web Call Integration</h3>
        <p>Place direct web calls to coordinate with pharmacists, patients, or suppliers ‚Äî integrated directly in the dashboard.</p>
      </div>
      <div class="feature-card reveal glow-on-scroll">
        <div class="feature-icon">üîí</div>
        <h3>Secure Admin Access</h3>
        <p>Role-based authentication with secure login. Full control over inventory, orders, and system settings.</p>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section class="section reveal" id="about">
    <div class="section-badge">ABOUT</div>
    <h2 class="section-title">Built for modern<br>pharmacies</h2>
    <p class="section-sub">Pharmly was built to solve the real challenges pharmacies face daily ‚Äî from tracking hundreds of products to managing patient relationships.</p>
    <div class="about-grid">
      <div>
        <p style="color:var(--text2);line-height:1.8;margin-bottom:20px;">Our platform combines an intelligent AI assistant with a robust admin dashboard, giving pharmacy teams the tools they need to operate efficiently, reduce errors, and serve patients better.</p>
        <p style="color:var(--text2);line-height:1.8;margin-bottom:28px;">From small independent pharmacies to large multi-location operations, Pharmly scales to meet your needs with enterprise-grade reliability and consumer-grade simplicity.</p>
        <button class="btn-secondary" onclick="navTo('admin')">Explore Admin Panel ‚Üí</button>
      </div>
      <div class="about-visual reveal">
        <div class="about-stat-grid">
          <div class="about-stat">
            <div class="num">52</div>
            <div class="lbl">Products in system</div>
          </div>
          <div class="about-stat">
            <div class="num">51</div>
            <div class="lbl">Patient records</div>
          </div>
          <div class="about-stat">
            <div class="num">‚Ç¨1.2k</div>
            <div class="lbl">Avg monthly revenue</div>
          </div>
          <div class="about-stat">
            <div class="num">AI</div>
            <div class="lbl">Real-time assistance</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SAFETY -->
  <section class="section reveal" id="safety">
    <div class="section-badge">SAFETY</div>
    <h2 class="section-title">Your data.<br>Always protected.</h2>
    <p class="section-sub">Security and compliance are built into every layer of Pharmly.</p>
    <div class="safety-grid">
      <div class="safety-card reveal">
        <div class="safety-icon">üîê</div>
        <h4>End-to-End Encryption</h4>
        <p>All patient data and medical records are encrypted in transit and at rest using industry-standard AES-256 encryption.</p>
      </div>
      <div class="safety-card reveal">
        <div class="safety-icon">üõ°Ô∏è</div>
        <h4>HIPAA Compliant</h4>
        <p>Built with healthcare compliance in mind. All workflows and data handling follow HIPAA guidelines and best practices.</p>
      </div>
      <div class="safety-card reveal">
        <div class="safety-icon">üîë</div>
        <h4>Secure Authentication</h4>
        <p>Multi-factor authentication and role-based access control ensure only authorized personnel can access sensitive information.</p>
      </div>
      <div class="safety-card reveal">
        <div class="safety-icon">üìã</div>
        <h4>Audit Logging</h4>
        <p>Every action in the system is logged with timestamps and user attribution, creating a complete audit trail for compliance.</p>
      </div>
      <div class="safety-card reveal">
        <div class="safety-icon">üåê</div>
        <h4>Data Residency</h4>
        <p>Choose where your data lives. We support regional data residency to comply with local data protection regulations.</p>
      </div>
      <div class="safety-card reveal">
        <div class="safety-icon">‚ö°</div>
        <h4>99.9% Uptime SLA</h4>
        <p>Our infrastructure is built for high availability with automatic failover and redundant systems across multiple data centers.</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer style="padding:40px;text-align:center;border-top:1px solid var(--border);color:var(--text3);font-size:13px;position:relative;z-index:1;">
    ¬© 2025 Pharmly. All rights reserved. Built with ‚ù§Ô∏è for modern pharmacies.
  </footer>
</div>

<!-- ===== PAGE: AI + ADMIN DASHBOARD ===== -->
<div id="page-dashboard" class="page">
  <div class="dashboard-layout">

    <!-- AI CHAT PANEL -->
    <div class="ai-panel">
      <div class="ai-header">
        <div class="ai-header-left">
          <div class="ai-avatar">ü§ñ</div>
          <div class="ai-title-block">
            <h2>AI Medication Assistant</h2>
            <p>Intelligent pharmacy support</p>
          </div>
        </div>
        <div style="display:flex;gap:10px;align-items:center;">
          <div class="status-dot">Online</div>
          <button class="btn-call" id="callBtn" onclick="toggleCall()">
            üìû Place Web Call
          </button>
        </div>
      </div>

      <!-- Call UI overlay -->
      <div id="callOverlay" style="display:none;padding:16px 24px;background:rgba(27,187,126,0.05);border-bottom:1px solid rgba(27,187,126,0.1);">
        <div style="display:flex;align-items:center;gap:12px;">
          <div style="width:40px;height:40px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:18px;animation:callPulse 1.5s infinite;">üìû</div>
          <div>
            <div style="font-weight:700;color:var(--accent);">Call in Progress</div>
            <div style="font-size:12px;color:var(--text2);" id="callTimer">00:00</div>
          </div>
          <button onclick="toggleCall()" style="margin-left:auto;padding:8px 16px;border-radius:8px;background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);color:var(--red);cursor:pointer;font-weight:600;font-size:12px;font-family:var(--font-body);">End Call</button>
        </div>
      </div>

      <div class="chat-messages" id="chatMessages">
        <!-- Initial AI welcome message -->
        <div class="msg ai">
          <div class="msg-avatar">ü§ñ</div>
          <div>
            <div class="msg-bubble">
              Hello! I'm your AI Medication Assistant. I can help you check stock, place orders, find medication information, and more. How can I assist you today?
            </div>
            <div class="msg-time" style="font-size:11px;color:var(--text3);margin-top:4px;padding-left:4px;">Just now</div>
          </div>
        </div>
        <div class="typing-indicator" id="typingIndicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>

      <div class="chat-input-area">
        <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;">
          <div onclick="sendQuick('What medicines are low on stock?')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:100px;font-size:12px;cursor:pointer;color:var(--text2);transition:var(--transition);" onmouseover="this.style.borderColor='rgba(27,187,126,0.4)'" onmouseout="this.style.borderColor='var(--border)'">üì¶ Check stock</div>
          <div onclick="sendQuick('Show me the most ordered products')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:100px;font-size:12px;cursor:pointer;color:var(--text2);transition:var(--transition);" onmouseover="this.style.borderColor='rgba(27,187,126,0.4)'" onmouseout="this.style.borderColor='var(--border)'">üìà Top products</div>
          <div onclick="sendQuick('I need Paracetamol 500mg')" style="padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:100px;font-size:12px;cursor:pointer;color:var(--text2);transition:var(--transition);" onmouseover="this.style.borderColor='rgba(27,187,126,0.4)'" onmouseout="this.style.borderColor='var(--border)'">üíä Order meds</div>
        </div>
        <div class="chat-input-row">
          <input class="chat-input" id="chatInput" placeholder="Type your medication request..." onkeydown="if(event.key==='Enter')sendMessage()">
          <button class="btn-send" onclick="sendMessage()">‚û§</button>
        </div>
      </div>
    </div>

    <!-- ADMIN DASHBOARD RIGHT PANEL -->
    <div class="admin-panel">
      <div class="admin-header">
        <div>
          <h2>Admin Dashboard</h2>
          <div class="admin-sub">Real-time pharmacy overview</div>
        </div>
        <div style="display:flex;gap:8px;">
          <div style="padding:8px 14px;background:var(--card2);border:1px solid var(--border);border-radius:8px;font-size:12px;color:var(--text2);">üîî <span id="alertCount" style="color:var(--red);font-weight:700;">3</span> Alerts</div>
          <button onclick="navTo('admin')" style="padding:8px 14px;background:var(--accent);border:none;border-radius:8px;font-size:12px;font-weight:700;color:#0a0f1a;cursor:pointer;">Full Panel ‚Üí</button>
        </div>
      </div>
      <div class="admin-content">

        <!-- Current Stock + Alerts -->
        <div class="mini-cards-row">
          <div class="mini-card">
            <div class="mini-card-label">Total Products</div>
            <div class="mini-card-val" style="color:var(--accent);">52</div>
            <div class="mini-card-change">‚Üë In system</div>
          </div>
          <div class="mini-card">
            <div class="mini-card-label">Patients</div>
            <div class="mini-card-val" style="color:var(--blue);">51</div>
            <div class="mini-card-change" style="color:var(--blue);">‚Üë Registered</div>
          </div>
          <div class="mini-card">
            <div class="mini-card-label">Low Stock Items</div>
            <div class="mini-card-val" style="color:var(--red);" id="lowStockCount">3</div>
            <div class="mini-card-change" style="color:var(--red);">‚ö†Ô∏è Needs attention</div>
          </div>
          <div class="mini-card">
            <div class="mini-card-label">Total Revenue</div>
            <div class="mini-card-val" style="color:var(--yellow);">‚Ç¨856</div>
            <div class="mini-card-change" style="color:var(--yellow);">‚Üë +8% this week</div>
          </div>
        </div>

        <!-- Low Stock Alerts -->
        <div class="alert-card">
          <div class="alert-title">‚ö†Ô∏è Low Stock Alerts</div>
          <div class="alert-item low"><span>Paracetamol 500mg</span><span class="badge red">Low Stock</span></div>
          <div class="alert-item warn"><span>Ibuprofen 200mg</span><span class="badge yellow">Refill Needed</span></div>
          <div class="alert-item low"><span>Cetirizin Tropfen</span><span class="badge red">Low Stock</span></div>
        </div>

        <!-- Recent Orders -->
        <div>
          <div style="font-size:13px;font-weight:700;color:var(--text2);margin-bottom:12px;display:flex;align-items:center;gap:6px;">üìã Recent Orders</div>
          <div class="order-item">
            <div>
              <div class="order-id">#ORD-1023</div>
              <div class="order-name">Panthenol Spray 130g</div>
            </div>
            <div style="text-align:right;">
              <span class="badge green">Completed</span>
              <div class="order-pills">‚Ç¨16.95</div>
            </div>
          </div>
          <div class="order-item">
            <div>
              <div class="order-id">#ORD-1022</div>
              <div class="order-name">NORSAN Omega-3 Total</div>
            </div>
            <div style="text-align:right;">
              <span class="badge blue">Pending</span>
              <div class="order-pills">‚Ç¨27.00</div>
            </div>
          </div>
          <div class="order-item">
            <div>
              <div class="order-id">#ORD-1021</div>
              <div class="order-name">Vividrin Augentropfen</div>
            </div>
            <div style="text-align:right;">
              <span class="badge green">Completed</span>
              <div class="order-pills">‚Ç¨8.28</div>
            </div>
          </div>
        </div>

        <!-- Inventory Overview -->
        <div class="alert-card">
          <div class="alert-title">üì¶ Inventory Overview</div>
          <table class="inv-table">
            <thead><tr><th>Medicine</th><th>Stock</th><th>Status</th></tr></thead>
            <tbody id="dashboardInvTable"></tbody>
          </table>
        </div>

        <!-- Pending Refills -->
        <div>
          <div style="font-size:13px;font-weight:700;color:var(--text2);margin-bottom:12px;">üîÑ Pending Refill Requests</div>
          <div class="refill-row"><span class="req-id">REQ-110</span><span style="flex:1;">Paracetamol apodiscounter 500mg</span><span class="badge yellow">Pending</span></div>
          <div class="refill-row"><span class="req-id">REQ-109</span><span style="flex:1;">NORSAN Omega-3 Kapseln</span><span class="badge yellow">Pending</span></div>
          <div class="refill-row"><span class="req-id">REQ-108</span><span style="flex:1;">Loperamid 2mg Hartkapseln</span><span class="badge red">Urgent</span></div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- ===== PAGE: ADMIN FULL PANEL ===== -->
<div id="page-admin" class="page">
  <div class="admin-sidebar">
    <div class="sidebar-section">
      <div class="sidebar-section-label">Main</div>
      <div class="sidebar-item active" onclick="showAdminPage('overview',this)"><span class="sidebar-icon">üìä</span><span>Overview</span></div>
      <div class="sidebar-item" onclick="showAdminPage('orders',this)"><span class="sidebar-icon">üìã</span><span>Orders</span><div class="sidebar-badge">52</div></div>
      <div class="sidebar-item" onclick="showAdminPage('stock',this)"><span class="sidebar-icon">üì¶</span><span>Stock</span></div>
      <div class="sidebar-item" onclick="showAdminPage('customers',this)"><span class="sidebar-icon">üë•</span><span>Customers</span></div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-label">Analytics</div>
      <div class="sidebar-item" onclick="showAdminPage('analytics',this)"><span class="sidebar-icon">üìà</span><span>Analytics</span></div>
    </div>
    <div class="sidebar-section" style="margin-top:auto;">
      <div class="sidebar-section-label">System</div>
      <div class="sidebar-item" onclick="navTo('home')"><span class="sidebar-icon">üè†</span><span>Home</span></div>
      <div class="sidebar-item" onclick="openLogin()"><span class="sidebar-icon">üîë</span><span>Login</span></div>
    </div>
  </div>

  <div class="admin-main">
    <div class="admin-topbar">
      <div id="adminPageTitle" class="admin-page-title">Sales Overview</div>
      <div style="display:flex;align-items:center;gap:16px;">
        <div class="search-wrapper">
          <div class="search-bar">
            <span>üîç</span>
            <input type="text" id="adminSearchInput" placeholder="Search medicine..." oninput="searchMedicine(this.value)">
          </div>
          <div class="search-result-panel" id="searchResultPanel"></div>
        </div>
        <div style="display:flex;align-items:center;gap:10px;font-size:14px;">
          <img src="https://api.dicebear.com/7.x/initials/svg?seed=James+Bond&backgroundColor=1bbb7e&fontFamily=Arial&fontSize=40" style="width:36px;height:36px;border-radius:10px;" onerror="this.style.display='none'">
          <div>
            <div style="font-weight:600;">James Bond</div>
            <div style="font-size:11px;color:var(--text3);">@admin</div>
          </div>
        </div>
      </div>
    </div>

    <div class="admin-body">

      <!-- OVERVIEW SUB-PAGE -->
      <div class="admin-subpage active" id="adminPage-overview">
        <!-- Stats cards -->
        <div class="stats-grid">
          <div class="stat-card green">
            <div class="lbl">Most Ordered Product</div>
            <div class="val" style="font-size:16px;line-height:1.3;">NORSAN Omega-3<br>Total</div>
            <div class="chg up">‚Üë Top seller this month</div>
          </div>
          <div class="stat-card blue">
            <div class="lbl">Total Profit</div>
            <div class="val">‚Ç¨12,500</div>
            <div class="chg up">‚Üë +8% since last week</div>
          </div>
          <div class="stat-card yellow">
            <div class="lbl">Total Cost</div>
            <div class="val">‚Ç¨48,200</div>
            <div class="chg down">‚Üì -0.2% since last week</div>
          </div>
          <div class="stat-card purple">
            <div class="lbl">Avg Order Value</div>
            <div class="val">‚Ç¨18.50</div>
            <div class="chg up">‚Üë +5% since last week</div>
          </div>
        </div>

        <!-- Charts row -->
        <div class="charts-grid">
          <div class="chart-card">
            <h4>Total Revenue</h4>
            <div class="chart-sub">Monthly sales performance</div>
            <div class="chart-container">
              <canvas id="revenueChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h4>Top Products</h4>
            <div class="chart-sub">This month</div>
            <div id="topProductsList">
              <div class="top-product-item">
                <div class="product-rank gold">1</div>
                <div class="product-info"><div class="pname">NORSAN Omega-3 Total</div><div class="psold">200ml ‚Äî 89 sold</div></div>
                <div class="product-price">‚Ç¨27</div>
              </div>
              <div class="top-product-item">
                <div class="product-rank silver">2</div>
                <div class="product-info"><div class="pname">Kijimea Reizdarm PRO</div><div class="psold">28 st ‚Äî 76 sold</div></div>
                <div class="product-price">‚Ç¨38.99</div>
              </div>
              <div class="top-product-item">
                <div class="product-rank bronze">3</div>
                <div class="product-info"><div class="pname">Magnesium Verla N</div><div class="psold">50 st ‚Äî 62 sold</div></div>
                <div class="product-price">‚Ç¨6.40</div>
              </div>
              <div class="top-product-item">
                <div class="product-rank">4</div>
                <div class="product-info"><div class="pname">Panthenol Spray</div><div class="psold">130g ‚Äî 58 sold</div></div>
                <div class="product-price">‚Ç¨16.95</div>
              </div>
              <div class="top-product-item">
                <div class="product-rank">5</div>
                <div class="product-info"><div class="pname">Bepanthen Wundsalbe</div><div class="psold">20g ‚Äî 51 sold</div></div>
                <div class="product-price">‚Ç¨7.69</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Orders By Time -->
        <div class="chart-card" style="margin-bottom:32px;">
          <h4>Orders By Time</h4>
          <div class="chart-sub">Weekly order patterns</div>
          <div class="heatmap-labels">
            <div class="hm-label">Sat</div><div class="hm-label">Sun</div>
            <div class="hm-label">Mon</div><div class="hm-label">Tue</div>
            <div class="hm-label">Wed</div><div class="hm-label">Thu</div>
            <div class="hm-label">Fri</div>
          </div>
          <div class="heatmap-grid" id="heatmapGrid"></div>
          <div style="display:flex;gap:8px;margin-top:12px;font-size:11px;color:var(--text3);align-items:center;">
            <span>Less</span>
            <div style="width:12px;height:12px;border-radius:3px;background:rgba(27,187,126,0.1);"></div>
            <div style="width:12px;height:12px;border-radius:3px;background:rgba(27,187,126,0.3);"></div>
            <div style="width:12px;height:12px;border-radius:3px;background:rgba(27,187,126,0.5);"></div>
            <div style="width:12px;height:12px;border-radius:3px;background:rgba(27,187,126,0.75);"></div>
            <div style="width:12px;height:12px;border-radius:3px;background:var(--accent);"></div>
            <span>More</span>
          </div>
        </div>

        <!-- Stock Status Overview -->
        <div class="charts-grid" style="grid-template-columns:1fr 1fr;margin-bottom:32px;">
          <div class="chart-card">
            <h4>Stock Distribution</h4>
            <div class="chart-sub">High / Medium / Low stock items</div>
            <div class="chart-container" style="height:180px;">
              <canvas id="stockPieChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h4>Price Range Distribution</h4>
            <div class="chart-sub">Products by price bracket</div>
            <div class="chart-container" style="height:180px;">
              <canvas id="priceChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- ORDERS SUB-PAGE -->
      <div class="admin-subpage" id="adminPage-orders">
        <div class="section-head">
          <h3>All Orders (52 Products)</h3>
          <div style="display:flex;gap:8px;">
            <div class="pill-tab active" onclick="filterOrders('all',this)">All</div>
            <div class="pill-tab" onclick="filterOrders('low',this)">Low Price</div>
            <div class="pill-tab" onclick="filterOrders('high',this)">High Price</div>
          </div>
        </div>
        <div class="table-card">
          <div class="table-wrapper">
            <table class="data-table" id="ordersTable">
              <thead>
                <tr>
                  <th>Product ID</th>
                  <th>Medicine Name</th>
                  <th>PZN</th>
                  <th>Package Size</th>
                  <th>Price</th>
                  <th>Stock</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="ordersTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- STOCK SUB-PAGE -->
      <div class="admin-subpage" id="adminPage-stock">
        <div class="section-head">
          <h3>Inventory & Stock Management</h3>
          <div style="display:flex;gap:8px;">
            <div class="pill-tab active" onclick="filterStock('all',this)">All</div>
            <div class="pill-tab" onclick="filterStock('high',this)">High Stock</div>
            <div class="pill-tab" onclick="filterStock('low',this)">Low Stock</div>
          </div>
        </div>
        <div style="margin-bottom:20px;display:flex;gap:16px;flex-wrap:wrap;">
          <div style="background:rgba(27,187,126,0.1);border:1px solid rgba(27,187,126,0.2);border-radius:10px;padding:16px 20px;display:flex;gap:10px;align-items:center;">
            <span style="font-size:24px;">‚úÖ</span>
            <div><div style="font-size:22px;font-weight:800;color:var(--accent);" id="highStockNum">0</div><div style="font-size:12px;color:var(--text3);">High Stock</div></div>
          </div>
          <div style="background:rgba(251,191,36,0.1);border:1px solid rgba(251,191,36,0.2);border-radius:10px;padding:16px 20px;display:flex;gap:10px;align-items:center;">
            <span style="font-size:24px;">‚ö†Ô∏è</span>
            <div><div style="font-size:22px;font-weight:800;color:var(--yellow);" id="medStockNum">0</div><div style="font-size:12px;color:var(--text3);">Medium Stock</div></div>
          </div>
          <div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);border-radius:10px;padding:16px 20px;display:flex;gap:10px;align-items:center;">
            <span style="font-size:24px;">üî¥</span>
            <div><div style="font-size:22px;font-weight:800;color:var(--red);" id="lowStockNumAdmin">0</div><div style="font-size:12px;color:var(--text3);">Low Stock</div></div>
          </div>
        </div>
        <div class="stock-grid" id="stockGrid"></div>
      </div>

      <!-- CUSTOMERS SUB-PAGE -->
      <div class="admin-subpage" id="adminPage-customers">
        <div class="section-head">
          <h3>Patient / Customer Records (51 total)</h3>
          <div style="display:flex;gap:8px;">
            <div class="pill-tab active" onclick="filterCustomers('all',this)">All</div>
            <div class="pill-tab" onclick="filterCustomers('M',this)">Male</div>
            <div class="pill-tab" onclick="filterCustomers('F',this)">Female</div>
            <div class="pill-tab" onclick="filterCustomers('rx',this)">Prescription Req.</div>
          </div>
        </div>
        <div class="customer-grid" id="customerGrid"></div>
      </div>

      <!-- ANALYTICS SUB-PAGE -->
      <div class="admin-subpage" id="adminPage-analytics">
        <div class="section-head"><h3>Advanced Analytics</h3></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px;">
          <div class="chart-card">
            <h4>Revenue by Month</h4>
            <div class="chart-sub">Last 12 months</div>
            <div class="chart-container" style="height:220px;"><canvas id="analyticsRevChart"></canvas></div>
          </div>
          <div class="chart-card">
            <h4>Gender Distribution</h4>
            <div class="chart-sub">Patient demographics</div>
            <div class="chart-container" style="height:220px;"><canvas id="genderChart"></canvas></div>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px;">
          <div class="chart-card">
            <h4>Age Distribution</h4>
            <div class="chart-sub">Patient age groups</div>
            <div class="chart-container" style="height:220px;"><canvas id="ageChart"></canvas></div>
          </div>
          <div class="chart-card">
            <h4>Dosage Frequency</h4>
            <div class="chart-sub">Most common dosage patterns</div>
            <div class="chart-container" style="height:220px;"><canvas id="dosageChart"></canvas></div>
          </div>
        </div>
        <div class="chart-card">
          <h4>Top 10 Products by Revenue</h4>
          <div class="chart-sub">Based on customer purchase data</div>
          <div class="chart-container" style="height:280px;"><canvas id="topProdChart"></canvas></div>
        </div>
      </div>

    </div><!-- end admin-body -->
  </div><!-- end admin-main -->
</div><!-- end page-admin -->

<script>
// ===== DATA =====
const PRODUCTS = [
  {id:16066,name:"Panthenol Spray, 46,3 mg/g Schaum",pzn:"04020784",price:16.95,size:"130 g",stock:45,desc:"Schaumspray zur Anwendung auf der Haut."},
  {id:976308,name:"NORSAN Omega-3 Total",pzn:"13476520",price:27,size:"200 ml",stock:89,desc:"Fl√ºssiges Omega-3-√ñl aus Fisch."},
  {id:977179,name:"NORSAN Omega-3 Vegan",pzn:"13476394",price:29,size:"100 ml",stock:34,desc:"Pflanzliches Omega-3 aus Algen."},
  {id:993687,name:"NORSAN Omega-3 Kapseln",pzn:"13512730",price:29,size:"120 st",stock:56,desc:"Omega-3-Kapseln t√§glich."},
  {id:1225428,name:"Vividrin iso EDO antiallerg. Augentropfen",pzn:"16507327",price:8.28,size:"30x0.5 ml",stock:12,desc:"Konservierungsmittelfreie Augentropfen."},
  {id:202796,name:"Aqualibra 80mg/90mg/180mg Filmtabletten",pzn:"02027960",price:27.82,size:"60 st",stock:38,desc:"Filmtabletten f√ºr Harnwegsinfekte."},
  {id:1103035,name:"Vitasprint Pro Energie",pzn:"11030350",price:15.95,size:"8 st",stock:5,desc:"Energiestoff-Kapseln."},
  {id:27955,name:"Cystinol akut",pzn:"00279550",price:26.5,size:"60 st",stock:22,desc:"F√ºr Harnwegsinfekte."},
  {id:30955,name:"Cromo-ratiopharm Augentropfen Einzeldosis",pzn:"00309550",price:7.59,size:"20x0.5 ml",stock:67,desc:"Augentropfen gegen Allergien."},
  {id:1162261,name:"Kijimea Reizdarm PRO",pzn:"11622610",price:38.99,size:"28 st",stock:76,desc:"Probiotikum f√ºr Reizdarm."},
  {id:1204782,name:"Mucosolvan 1 mal t√§glich Retardkapseln",pzn:"12047820",price:39.97,size:"50 st",stock:29,desc:"Schleiml√∂ser Retardkapseln."},
  {id:1210016,name:"OMNi-BiOTiC SR-9 mit B-Vitaminen",pzn:"12100160",price:44.5,size:"28x3 g",stock:41,desc:"Probiotikum mit B-Vitaminen."},
  {id:1245942,name:"Osa Schorf Spray",pzn:"12459420",price:15.45,size:"30 ml",stock:18,desc:"Spray gegen Wundschorf."},
  {id:1247528,name:"Multivitamin Fruchtgummib√§rchen vegan",pzn:"12475280",price:12.74,size:"60 st",stock:92,desc:"Vegane Multivitamin-Gummib√§rchen."},
  {id:1273105,name:"Iberogast Classic Fl√ºssigkeit",pzn:"12731050",price:28.98,size:"50 ml",stock:33,desc:"Fl√ºssigkeit f√ºr Magenbeschwerden."},
  {id:1358905,name:"COLPOFIX",pzn:"13589050",price:49.6,size:"40 ml",stock:14,desc:"Vaginalpflege-Gel."},
  {id:1293377,name:"Augentropfen RedCare",pzn:"12933770",price:12.69,size:"10 ml",stock:55,desc:"Allgemeine Augentropfen."},
  {id:1313639,name:"MULTILAC Darmsynbiotikum",pzn:"13136390",price:9.99,size:"10 st",stock:48,desc:"Darm-Synbiotikum Kapseln."},
  {id:1319766,name:"SAW PALMETO 350mg",pzn:"13197660",price:8.47,size:"100 st",stock:71,desc:"S√§gepalme-Kapseln."},
  {id:1329121,name:"Paracetamol apodiscounter 500mg",pzn:"13291210",price:2.06,size:"20 st",stock:8,desc:"Paracetamol Tabletten."},
  {id:1352774,name:"Prostata Men Kapseln",pzn:"13527740",price:19.99,size:"60 st",stock:27,desc:"Prostatapflege-Kapseln."},
  {id:1357649,name:"Natural Intimate Creme",pzn:"13576490",price:18.9,size:"50 ml",stock:31,desc:"Intime Pflegecreme."},
  {id:1358513,name:"proBIO 6 Probiotik Kapseln APOMIA",pzn:"13585130",price:34.9,size:"30 st",stock:43,desc:"Probiotikum Kapseln."},
  {id:1363580,name:"Eucerin DERMOPURE Triple Effect Gel",pzn:"13635800",price:17.25,size:"150 ml",stock:60,desc:"Reinigungsgel f√ºr unreine Haut."},
  {id:1381140,name:"frida baby FlakeFixer",pzn:"13811400",price:0,size:"1 st",stock:15,desc:"Baby-Pflege-Set."},
  {id:1383626,name:"Vitasprint Duo Energie",pzn:"13836260",price:16.95,size:"20 st",stock:39,desc:"Energie-Kapseln Duo."},
  {id:11334,name:"Bepanthen Wund- und Heilsalbe 50mg/g",pzn:"00113340",price:7.69,size:"20 g",stock:51,desc:"Wundheilsalbe."},
  {id:1391185,name:"V-Biotics Flora Complex",pzn:"13911850",price:19.9,size:"19 g",stock:24,desc:"Probiotikum-Pulver."},
  {id:1403860,name:"Aveeno Skin Relief Body Lotion",pzn:"14038600",price:14.99,size:"300 ml",stock:68,desc:"K√∂rperlotion f√ºr trockene Haut."},
  {id:1434198,name:"Centrum Vital+ Mentale Leistung",pzn:"14341980",price:19.95,size:"30 st",stock:37,desc:"Multivitamin f√ºr mentale Leistung."},
  {id:1434864,name:"Redcare Wundschutzcreme",pzn:"14348640",price:14.39,size:"100 ml",stock:46,desc:"Wundschutz-Creme."},
  {id:1435154,name:"Cetaphil Sanft gl√§ttende SA Reinigung",pzn:"14351540",price:13.95,size:"236 ml",stock:53,desc:"Sanfte SA-Reinigung."},
  {id:14176,name:"Magnesium Verla N Drag√©es",pzn:"00141760",price:6.4,size:"50 st",stock:62,desc:"Magnesium-Drag√©es."},
  {id:704523,name:"Livocab direkt Augentropfen 0,05%",pzn:"07045230",price:14.99,size:"4 ml",stock:19,desc:"Antiallergische Augentropfen."},
  {id:185422,name:"Cetirizin HEXAL Tropfen 10mg/ml",pzn:"01854220",price:13.19,size:"10 ml",stock:7,desc:"Antiallergische Tropfen."},
  {id:198010,name:"Loperamid akut 1A Pharma 2mg Hartkapseln",pzn:"01980100",price:3.93,size:"10 st",stock:84,desc:"Gegen Durchfall."},
  {id:202006,name:"Ramipril 1A Pharma 10mg Tabletten",pzn:"02020060",price:12.59,size:"20 st",stock:26,desc:"ACE-Hemmer Tabletten."},
  {id:306595,name:"GRANU FINK femina Hartkapseln",pzn:"03065950",price:20.29,size:"30 st",stock:33,desc:"F√ºr Harnwegsgesundheit bei Frauen."},
  {id:324024,name:"Vitasprint B12 Kapseln",pzn:"03240240",price:17.04,size:"20 st",stock:44,desc:"Vitamin B12 Kapseln."},
  {id:332568,name:"Sinupret Saft",pzn:"03325680",price:13.3,size:"100 ml",stock:57,desc:"Phytotherapeutikum gegen Sinusitis."},
  {id:335765,name:"Nurofen 200mg Schmelztabletten Lemon",pzn:"03357650",price:10.98,size:"12 st",stock:9,desc:"Schmelztabletten mit Ibuprofein."},
  {id:363715,name:"Vitamin B-Komplex-ratiopharm",pzn:"03637150",price:24.97,size:"60 st",stock:72,desc:"B-Vitamin-Komplex."},
  {id:368333,name:"Calmvalera Hevert Tropfen",pzn:"03683330",price:35.97,size:"100 ml",stock:28,desc:"Beruhigungstropfen hom√∂opathisch."},
  {id:1248085,name:"femiLoges 4mg magensaftresistente Tabletten",pzn:"12480850",price:20.44,size:"30 st",stock:21,desc:"F√ºr Frauengesundheit."},
  {id:376212,name:"Umckaloabo Saft f√ºr Kinder",pzn:"03762120",price:13.15,size:"120 ml",stock:16,desc:"Kindersaft gegen Erk√§ltung."},
  {id:368367,name:"DulcoLax Drag√©es 5mg",pzn:"03683670",price:22.9,size:"100 st",stock:49,desc:"Abf√ºhrmittel Drag√©es."},
  {id:717525,name:"Diclo-ratiopharm Schmerzgel",pzn:"07175250",price:8.89,size:"50 g",stock:63,desc:"Schmerzgel mit Diclofenac."},
  {id:772646,name:"Minoxidil BIO-H-TIN 20mg/ml Spray",pzn:"07726460",price:22.5,size:"60 ml",stock:35,desc:"Gegen Haarausfall."},
  {id:790415,name:"Hyaluron-ratiopharm Augentropfen",pzn:"07904150",price:13.74,size:"10 ml",stock:58,desc:"Augentropfen mit Hyaluron."},
  {id:790661,name:"FeniHydrocort Creme 0,25%",pzn:"07906610",price:8.59,size:"20 g",stock:42,desc:"Hydrocortison-Creme."},
  {id:879236,name:"Eucerin UreaRepair PLUS Lotion 10%",pzn:"08792360",price:27.75,size:"400 ml",stock:66,desc:"K√∂rperlotion mit 10% Urea."},
  {id:899231,name:"Vigantolvit 2000 I.E. Vitamin D3",pzn:"08992310",price:17.99,size:"120 st",stock:80,desc:"Vitamin D3 Tabletten."},
];

const CUSTOMERS = [
  {id:"PAT001",age:45,gender:"F",date:"2024-03-15",product:"Panthenol Spray, 46,3 mg/g",qty:1,price:16.95,dosage:"Once daily",rx:"No"},
  {id:"PAT002",age:62,gender:"M",date:"2024-03-14",product:"NORSAN Omega-3 Total",qty:2,price:54,dosage:"Once daily",rx:"No"},
  {id:"PAT003",age:38,gender:"F",date:"2024-03-14",product:"Vividrin iso EDO Augentropfen",qty:1,price:8.28,dosage:"Twice daily",rx:"No"},
  {id:"PAT004",age:55,gender:"M",date:"2024-03-13",product:"Kijimea Reizdarm PRO",qty:1,price:38.99,dosage:"Once daily",rx:"No"},
  {id:"PAT005",age:29,gender:"F",date:"2024-03-13",product:"Cetirizin HEXAL Tropfen",qty:1,price:13.19,dosage:"Once daily",rx:"No"},
  {id:"PAT006",age:71,gender:"M",date:"2024-03-12",product:"Ramipril 1A Pharma 10mg",qty:1,price:12.59,dosage:"Once daily",rx:"Yes"},
  {id:"PAT007",age:34,gender:"F",date:"2024-03-12",product:"NORSAN Omega-3 Vegan",qty:2,price:58,dosage:"Once daily",rx:"No"},
  {id:"PAT008",age:48,gender:"M",date:"2024-03-11",product:"Mucosolvan Retardkapseln",qty:1,price:39.97,dosage:"Once daily",rx:"No"},
  {id:"PAT009",age:25,gender:"F",date:"2024-03-11",product:"Multivitamin Fruchtgummib√§rchen",qty:1,price:12.74,dosage:"Once daily",rx:"No"},
  {id:"PAT010",age:67,gender:"M",date:"2024-03-10",product:"Vigantolvit 2000 Vitamin D3",qty:2,price:35.98,dosage:"Once daily",rx:"No"},
  {id:"PAT011",age:41,gender:"F",date:"2024-03-10",product:"Eucerin UreaRepair Lotion",qty:1,price:27.75,dosage:"Twice daily",rx:"No"},
  {id:"PAT012",age:58,gender:"M",date:"2024-03-09",product:"Cystinol akut",qty:1,price:26.5,dosage:"Three times daily",rx:"No"},
  {id:"PAT013",age:33,gender:"F",date:"2024-03-09",product:"Vitamin B-Komplex-ratiopharm",qty:1,price:24.97,dosage:"Once daily",rx:"No"},
  {id:"PAT014",age:52,gender:"M",date:"2024-03-08",product:"COLPOFIX",qty:1,price:49.6,dosage:"Once daily",rx:"Yes"},
  {id:"PAT015",age:44,gender:"F",date:"2024-03-08",product:"Centrum Vital+ Mentale Leistung",qty:1,price:19.95,dosage:"Once daily",rx:"No"},
  {id:"PAT016",age:37,gender:"M",date:"2024-03-07",product:"Loperamid akut 2mg",qty:2,price:7.86,dosage:"As needed",rx:"No"},
  {id:"PAT017",age:60,gender:"F",date:"2024-03-07",product:"OMNi-BiOTiC SR-9",qty:1,price:44.5,dosage:"Once daily",rx:"No"},
  {id:"PAT018",age:28,gender:"M",date:"2024-03-06",product:"Nurofen 200mg Schmelztabletten",qty:2,price:21.96,dosage:"As needed",rx:"No"},
  {id:"PAT019",age:55,gender:"F",date:"2024-03-06",product:"Sinupret Saft",qty:1,price:13.3,dosage:"Three times daily",rx:"No"},
  {id:"PAT020",age:49,gender:"M",date:"2024-03-05",product:"Bepanthen Wundsalbe 50mg/g",qty:2,price:15.38,dosage:"Twice daily",rx:"No"},
  {id:"PAT021",age:31,gender:"F",date:"2024-03-05",product:"Aveeno Skin Relief Lotion",qty:1,price:14.99,dosage:"Once daily",rx:"No"},
  {id:"PAT022",age:65,gender:"M",date:"2024-03-04",product:"Calmvalera Hevert Tropfen",qty:1,price:35.97,dosage:"Three times daily",rx:"No"},
  {id:"PAT023",age:42,gender:"F",date:"2024-03-04",product:"proBIO 6 Probiotik Kapseln",qty:1,price:34.9,dosage:"Once daily",rx:"No"},
  {id:"PAT024",age:56,gender:"M",date:"2024-03-03",product:"Aqualibra 80mg Filmtabletten",qty:1,price:27.82,dosage:"Three times daily",rx:"No"},
  {id:"PAT025",age:38,gender:"F",date:"2024-03-03",product:"femiLoges 4mg Tabletten",qty:1,price:20.44,dosage:"Once daily",rx:"Yes"},
  {id:"PAT026",age:72,gender:"M",date:"2024-03-02",product:"Magnesium Verla N Drag√©es",qty:2,price:12.8,dosage:"Once daily",rx:"No"},
  {id:"PAT027",age:27,gender:"F",date:"2024-03-02",product:"Cetaphil SA Reinigung",qty:1,price:13.95,dosage:"Twice daily",rx:"No"},
  {id:"PAT028",age:50,gender:"M",date:"2024-03-01",product:"DulcoLax Drag√©es 5mg",qty:1,price:22.9,dosage:"As needed",rx:"No"},
  {id:"PAT029",age:36,gender:"F",date:"2024-02-29",product:"Iberogast Classic",qty:1,price:28.98,dosage:"Three times daily",rx:"No"},
  {id:"PAT030",age:63,gender:"M",date:"2024-02-28",product:"SAW PALMETO 350mg",qty:1,price:8.47,dosage:"Once daily",rx:"No"},
  {id:"PAT031",age:46,gender:"F",date:"2024-02-28",product:"GRANU FINK femina",qty:1,price:20.29,dosage:"Once daily",rx:"No"},
  {id:"PAT032",age:53,gender:"M",date:"2024-02-27",product:"Diclo-ratiopharm Schmerzgel",qty:2,price:17.78,dosage:"Twice daily",rx:"No"},
  {id:"PAT033",age:30,gender:"F",date:"2024-02-27",product:"Eucerin DERMOPURE Gel",qty:1,price:17.25,dosage:"Twice daily",rx:"No"},
  {id:"PAT034",age:68,gender:"M",date:"2024-02-26",product:"Prostata Men Kapseln",qty:1,price:19.99,dosage:"Once daily",rx:"No"},
  {id:"PAT035",age:43,gender:"F",date:"2024-02-26",product:"Hyaluron-ratiopharm Augentropfen",qty:2,price:27.48,dosage:"Four times daily",rx:"No"},
  {id:"PAT036",age:57,gender:"M",date:"2024-02-25",product:"Vitasprint B12 Kapseln",qty:1,price:17.04,dosage:"Once daily",rx:"No"},
  {id:"PAT037",age:35,gender:"F",date:"2024-02-25",product:"Natural Intimate Creme",qty:1,price:18.9,dosage:"Once daily",rx:"No"},
  {id:"PAT038",age:61,gender:"M",date:"2024-02-24",product:"Minoxidil BIO-H-TIN Spray",qty:1,price:22.5,dosage:"Twice daily",rx:"No"},
  {id:"PAT039",age:26,gender:"F",date:"2024-02-24",product:"Livocab direkt Augentropfen",qty:1,price:14.99,dosage:"Twice daily",rx:"No"},
  {id:"PAT040",age:74,gender:"M",date:"2024-02-23",product:"Cromo-ratiopharm Augentropfen",qty:2,price:15.18,dosage:"Four times daily",rx:"No"},
  {id:"PAT041",age:40,gender:"F",date:"2024-02-23",product:"Redcare Wundschutzcreme",qty:1,price:14.39,dosage:"Twice daily",rx:"No"},
  {id:"PAT042",age:54,gender:"M",date:"2024-02-22",product:"FeniHydrocort Creme 0,25%",qty:1,price:8.59,dosage:"Twice daily",rx:"No"},
  {id:"PAT043",age:32,gender:"F",date:"2024-02-22",product:"Umckaloabo Saft f√ºr Kinder",qty:2,price:26.3,dosage:"Three times daily",rx:"No"},
  {id:"PAT044",age:69,gender:"M",date:"2024-02-21",product:"Augentropfen RedCare",qty:1,price:12.69,dosage:"Three times daily",rx:"No"},
  {id:"PAT045",age:48,gender:"F",date:"2024-02-21",product:"MULTILAC Darmsynbiotikum",qty:2,price:19.98,dosage:"Once daily",rx:"No"},
  {id:"PAT046",age:39,gender:"M",date:"2024-02-20",product:"Vitasprint Pro Energie",qty:1,price:15.95,dosage:"Once daily",rx:"No"},
  {id:"PAT047",age:73,gender:"F",date:"2024-02-20",product:"V-Biotics Flora Complex",qty:1,price:19.9,dosage:"Once daily",rx:"No"},
  {id:"PAT048",age:44,gender:"M",date:"2024-02-19",product:"Osa Schorf Spray",qty:1,price:15.45,dosage:"Twice daily",rx:"No"},
  {id:"PAT049",age:28,gender:"F",date:"2024-02-19",product:"Paracetamol apodiscounter 500mg",qty:2,price:4.12,dosage:"As needed",rx:"No"},
  {id:"PAT050",age:59,gender:"M",date:"2024-02-18",product:"Cystinol akut",qty:1,price:26.5,dosage:"Twice daily",rx:"No"},
  {id:"PAT051",age:47,gender:"F",date:"2024-02-18",product:"NORSAN Omega-3 Kapseln",qty:2,price:58,dosage:"Once daily",rx:"No"},
];

// State
let currentPage = 'home';
let callActive = false;
let callTimer = null;
let callSeconds = 0;
let stockData = {};
PRODUCTS.forEach(p => { stockData[p.id] = p.stock; });

// ===== NAVIGATION =====
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const el = document.getElementById('page-' + page);
  if(el) el.classList.add('active');
  currentPage = page;
  window.scrollTo(0,0);
  if(page === 'admin') initAdminPage();
  if(page === 'dashboard') initDashboard();
}

function navTo(page, el) {
  showPage(page);
  document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
  if(el) el.classList.add('active');
}

function scrollToSection(id) {
  if(currentPage !== 'home') {
    showPage('home');
    setTimeout(() => {
      const el = document.getElementById(id);
      if(el) el.scrollIntoView({behavior:'smooth'});
    }, 100);
  } else {
    const el = document.getElementById(id);
    if(el) el.scrollIntoView({behavior:'smooth'});
  }
}

// ===== LOGIN =====
function openLogin() {
  document.getElementById('loginModal').classList.add('open');
}
function closeLogin() {
  document.getElementById('loginModal').classList.remove('open');
  document.getElementById('loginError').style.display = 'none';
}
function doLogin() {
  const u = document.getElementById('loginUser').value.trim();
  const e = document.getElementById('loginEmail').value.trim();
  const p = document.getElementById('loginPass').value;
  if(u === 'admin' && e === 'admin@pharmly.com' && p === 'admin123') {
    closeLogin();
    showPage('admin');
    showToast('‚úÖ','Welcome back, Admin!');
  } else {
    document.getElementById('loginError').style.display = 'block';
  }
}

// ===== TOAST =====
function showToast(icon, msg) {
  document.getElementById('toastIcon').textContent = icon;
  document.getElementById('toastMsg').textContent = msg;
  const t = document.getElementById('toast');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== CALL =====
function toggleCall() {
  callActive = !callActive;
  const btn = document.getElementById('callBtn');
  const overlay = document.getElementById('callOverlay');
  if(callActive) {
    btn.innerHTML = 'üìµ End Call';
    btn.classList.add('calling');
    overlay.style.display = 'block';
    callSeconds = 0;
    callTimer = setInterval(() => {
      callSeconds++;
      const m = String(Math.floor(callSeconds/60)).padStart(2,'0');
      const s = String(callSeconds%60).padStart(2,'0');
      document.getElementById('callTimer').textContent = m + ':' + s;
    }, 1000);
    showToast('üìû','Web call connected!');
  } else {
    btn.innerHTML = 'üìû Place Web Call';
    btn.classList.remove('calling');
    overlay.style.display = 'none';
    clearInterval(callTimer);
    showToast('üìµ','Call ended.');
  }
}

// ===== AI CHAT =====
const AI_RESPONSES = {
  stock: () => {
    const low = PRODUCTS.filter(p => stockData[p.id] < 20);
    return `üì¶ **Low Stock Alert!** ${low.length} products need attention:\n\n${low.map(p => `‚Ä¢ ${p.name}: ${stockData[p.id]} units left`).join('\n')}\n\nWould you like me to initiate refill requests?`;
  },
  order: (query) => {
    const match = PRODUCTS.find(p => p.name.toLowerCase().includes(query.toLowerCase()));
    if(match) return `‚úÖ **Order Approved!** I've prepared an order for **${match.name}** (${match.size}).\n\nüíä Price: ‚Ç¨${match.price}\nüì¶ Current Stock: ${stockData[match.id]} units\n\nüîî Notifying pharmacy now...`;
    return `I couldn't find that exact medication. Could you be more specific? I have ${PRODUCTS.length} products in my database.`;
  },
  top: () => {
    const sorted = [...PRODUCTS].sort((a,b) => stockData[b.id] - stockData[a.id]).slice(0,5);
    return `üìà **Top Products by Stock:**\n\n${sorted.map((p,i) => `${i+1}. ${p.name} ‚Äî ${stockData[p.id]} units @ ‚Ç¨${p.price}`).join('\n')}`;
  },
  default: () => {
    const responses = [
      "I'm your AI Medication Assistant. I can help you check inventory, place orders, or provide medication information. What do you need?",
      "Let me look that up for you! For specific medication inquiries, I have access to our full inventory of 52 products.",
      "I'd be happy to help! Try asking me to 'check stock', 'place an order', or 'show top products'.",
    ];
    return responses[Math.floor(Math.random() * responses.length)];
  }
};

function getAIResponse(msg) {
  const lower = msg.toLowerCase();
  if(lower.includes('stock') || lower.includes('low') || lower.includes('inventory')) return AI_RESPONSES.stock();
  if(lower.includes('top') || lower.includes('most ordered') || lower.includes('popular')) return AI_RESPONSES.top();
  if(lower.includes('order') || lower.includes('need') || lower.includes('want') || lower.includes('paracetamol') || lower.includes('ibuprofen')) {
    const medMatch = PRODUCTS.find(p => p.name.toLowerCase().split(/[\s,]/)[0] in lower || lower.includes(p.name.toLowerCase().split(/[\s,]/)[0]));
    if(medMatch) return AI_RESPONSES.order(medMatch.name);
    return AI_RESPONSES.order(msg);
  }
  return AI_RESPONSES.default();
}

function sendMessage() {
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if(!msg) return;
  input.value = '';
  appendMessage('user', msg);
  document.getElementById('typingIndicator').style.display = 'flex';
  setTimeout(() => {
    document.getElementById('typingIndicator').style.display = 'none';
    appendMessage('ai', getAIResponse(msg));
  }, 1200 + Math.random() * 800);
}

function sendQuick(msg) {
  document.getElementById('chatInput').value = msg;
  sendMessage();
}

function appendMessage(role, text) {
  const container = document.getElementById('chatMessages');
  const time = new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  const formatted = text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>');
  const div = document.createElement('div');
  div.className = 'msg ' + role;
  div.innerHTML = `
    <div class="msg-avatar">${role === 'ai' ? 'ü§ñ' : 'üë§'}</div>
    <div>
      <div class="msg-bubble">${formatted}</div>
      ${role === 'ai' ? '<div class="msg-notify">üîî Notifying pharmacy</div>' : ''}
      <div class="msg-time">${time}</div>
    </div>
  `;
  // Insert before typing indicator
  const typing = document.getElementById('typingIndicator');
  container.insertBefore(div, typing);
  container.scrollTop = container.scrollHeight;
}

// ===== DASHBOARD INIT =====
function initDashboard() {
  const tbody = document.getElementById('dashboardInvTable');
  if(!tbody) return;
  const sample = PRODUCTS.slice(0, 8);
  tbody.innerHTML = sample.map(p => {
    const s = stockData[p.id];
    const cls = s < 20 ? 'red' : s < 40 ? 'yellow' : 'green';
    const lbl = s < 20 ? 'Low' : s < 40 ? 'Medium' : 'In Stock';
    return `<tr><td>${p.name.substring(0,30)}‚Ä¶</td><td><strong>${s}</strong></td><td><span class="badge ${cls}">${lbl}</span></td></tr>`;
  }).join('');
}

// ===== ADMIN PAGE =====
let chartsInitialized = false;

function initAdminPage() {
  renderOrdersTable(PRODUCTS);
  renderStockGrid(PRODUCTS);
  renderCustomers(CUSTOMERS);
  if(!chartsInitialized) {
    initCharts();
    chartsInitialized = true;
  }
  generateHeatmap();
  updateStockCounts();
}

function showAdminPage(page, el) {
  document.querySelectorAll('.admin-subpage').forEach(p => p.classList.remove('active'));
  document.getElementById('adminPage-' + page).classList.add('active');
  document.querySelectorAll('.sidebar-item').forEach(s => s.classList.remove('active'));
  if(el) el.classList.add('active');
  const titles = {overview:'Sales Overview',orders:'Orders',stock:'Inventory',customers:'Customers',analytics:'Analytics'};
  document.getElementById('adminPageTitle').textContent = titles[page] || page;
  if(page === 'analytics') initAnalyticsCharts();
}

// Orders Table
function renderOrdersTable(products) {
  const tbody = document.getElementById('ordersTableBody');
  tbody.innerHTML = products.map((p, i) => {
    const s = stockData[p.id];
    const statusCls = s < 20 ? 'red' : s < 40 ? 'yellow' : 'green';
    const statusLbl = s < 20 ? 'Low Stock' : s < 40 ? 'Medium' : 'In Stock';
    const ordStatus = i % 3 === 0 ? '<span class="badge blue">Pending</span>' : i % 3 === 1 ? '<span class="badge green">Completed</span>' : '<span class="badge yellow">In Progress</span>';
    const barPct = Math.min(100, (s/100)*100);
    const barCls = s < 20 ? 'low' : s < 50 ? 'medium' : 'high';
    return `<tr>
      <td class="td-id">${p.id}</td>
      <td class="td-name">${p.name}</td>
      <td class="td-id">${p.pzn}</td>
      <td style="color:var(--text2);font-size:13px;">${p.size}</td>
      <td class="td-price">‚Ç¨${p.price > 0 ? p.price.toFixed(2) : 'Free'}</td>
      <td><div class="stock-bar-wrap"><span class="stock-num">${s}</span><div class="stock-bar-bg"><div class="stock-bar-fill ${barCls}" style="width:${barPct}%"></div></div></div></td>
      <td><span class="badge ${statusCls}">${statusLbl}</span></td>
      <td>${ordStatus}</td>
    </tr>`;
  }).join('');
}

function filterOrders(type, el) {
  document.querySelectorAll('#adminPage-orders .pill-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  let filtered = [...PRODUCTS];
  if(type === 'low') filtered = filtered.filter(p => p.price < 15);
  else if(type === 'high') filtered = filtered.filter(p => p.price >= 15);
  renderOrdersTable(filtered);
}

// Stock Grid
function renderStockGrid(products) {
  const grid = document.getElementById('stockGrid');
  grid.innerHTML = products.map(p => {
    const s = stockData[p.id];
    const cls = s < 20 ? 'low-stock' : s > 50 ? 'high-stock' : '';
    const qtyCls = s < 20 ? 'qty-low' : s < 40 ? 'qty-med' : 'qty-high';
    return `<div class="stock-card ${cls}" id="stockcard-${p.id}">
      <div class="stock-card-top">
        <div class="stock-name">${p.name}</div>
        <span class="badge ${s < 20 ? 'red' : s < 40 ? 'yellow' : 'green'}">${s < 20 ? 'Low' : s < 40 ? 'Med' : 'High'}</span>
      </div>
      <div class="stock-qty ${qtyCls}" id="qty-${p.id}">${s}</div>
      <div class="stock-size">${p.size} ¬∑ ‚Ç¨${p.price > 0 ? p.price : 'Free'}</div>
      <div class="stock-input-row">
        <input class="stock-input" type="number" id="input-${p.id}" placeholder="New qty" min="0">
        <button class="btn-stock-update" onclick="updateStock(${p.id})">Update</button>
      </div>
    </div>`;
  }).join('');
  updateStockCounts();
}

function updateStock(id) {
  const input = document.getElementById('input-' + id);
  const newVal = parseInt(input.value);
  if(isNaN(newVal) || newVal < 0) { showToast('‚ö†Ô∏è','Please enter a valid number'); return; }
  stockData[id] = newVal;
  input.value = '';
  document.getElementById('qty-' + id).textContent = newVal;
  const card = document.getElementById('stockcard-' + id);
  const badge = card.querySelector('.badge');
  const qtydiv = card.querySelector('.stock-qty');
  card.className = 'stock-card ' + (newVal < 20 ? 'low-stock' : newVal > 50 ? 'high-stock' : '');
  badge.className = 'badge ' + (newVal < 20 ? 'red' : newVal < 40 ? 'yellow' : 'green');
  badge.textContent = newVal < 20 ? 'Low' : newVal < 40 ? 'Med' : 'High';
  qtydiv.className = 'stock-qty ' + (newVal < 20 ? 'qty-low' : newVal < 40 ? 'qty-med' : 'qty-high');
  updateStockCounts();
  showToast('‚úÖ', `Stock updated to ${newVal} units!`);
  // Update charts if visible
  if(chartsInitialized) updateStockPieChart();
}

function updateStockCounts() {
  const vals = PRODUCTS.map(p => stockData[p.id]);
  const high = vals.filter(v => v >= 40).length;
  const med = vals.filter(v => v >= 20 && v < 40).length;
  const low = vals.filter(v => v < 20).length;
  const el1 = document.getElementById('highStockNum');
  const el2 = document.getElementById('medStockNum');
  const el3 = document.getElementById('lowStockNumAdmin');
  if(el1) el1.textContent = high;
  if(el2) el2.textContent = med;
  if(el3) el3.textContent = low;
  const lsc = document.getElementById('lowStockCount');
  if(lsc) lsc.textContent = low;
}

function filterStock(type, el) {
  document.querySelectorAll('#adminPage-stock .pill-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  let filtered = [...PRODUCTS];
  if(type === 'high') filtered = filtered.filter(p => stockData[p.id] >= 40);
  else if(type === 'low') filtered = filtered.filter(p => stockData[p.id] < 20);
  renderStockGrid(filtered);
}

// Customers
function renderCustomers(customers) {
  const grid = document.getElementById('customerGrid');
  const colors = ['#1bbb7e','#3b82f6','#8b5cf6','#f59e0b','#ef4444','#ec4899'];
  grid.innerHTML = customers.map((c, i) => {
    const color = colors[i % colors.length];
    const initials = c.id.replace('PAT','P');
    return `<div class="customer-card">
      <div class="cust-avatar" style="background:${color}20;border:2px solid ${color}40;color:${color};">${initials}</div>
      <div class="cust-id">${c.id}</div>
      <div class="cust-name">Patient, Age ${c.age}</div>
      <div class="cust-meta">Gender: ${c.gender === 'M' ? 'üë® Male' : 'üë© Female'} ¬∑ ${c.dosage}</div>
      <div class="cust-product">üíä ${c.product}</div>
      <div class="cust-footer">
        <span class="cust-price">‚Ç¨${c.price.toFixed(2)}</span>
        <span class="cust-date">${c.date}</span>
        <span class="badge ${c.rx === 'Yes' ? 'red' : 'green'}">${c.rx === 'Yes' ? 'Rx Required' : 'OTC'}</span>
      </div>
    </div>`;
  }).join('');
}

function filterCustomers(type, el) {
  document.querySelectorAll('#adminPage-customers .pill-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  let filtered = [...CUSTOMERS];
  if(type === 'M') filtered = filtered.filter(c => c.gender === 'M');
  else if(type === 'F') filtered = filtered.filter(c => c.gender === 'F');
  else if(type === 'rx') filtered = filtered.filter(c => c.rx === 'Yes');
  renderCustomers(filtered);
}

// ===== SEARCH =====
function searchMedicine(query) {
  const panel = document.getElementById('searchResultPanel');
  if(!query.trim()) { panel.style.display = 'none'; return; }
  const results = PRODUCTS.filter(p => p.name.toLowerCase().includes(query.toLowerCase())).slice(0, 6);
  if(!results.length) { panel.style.display = 'none'; return; }
  panel.style.display = 'block';
  panel.innerHTML = results.map(p => {
    const s = stockData[p.id];
    const cls = s < 20 ? 'red' : s < 40 ? 'yellow' : 'green';
    const lbl = s < 20 ? 'üî¥ Low Stock' : s < 40 ? 'üü° Medium' : 'üü¢ In Stock';
    return `<div class="search-result-item" onclick="panel.style.display='none'">
      <span class="badge ${cls} stock-badge">${lbl}</span>
      <div class="med-name">${p.name}</div>
      <div class="med-details">${p.size} ¬∑ ‚Ç¨${p.price} ¬∑ Stock: ${s} units</div>
    </div>`;
  }).join('');
}
document.addEventListener('click', e => {
  if(!e.target.closest('.search-wrapper')) {
    const p = document.getElementById('searchResultPanel');
    if(p) p.style.display = 'none';
  }
});

// ===== CHARTS =====
const chartDefaults = {
  color: 'rgba(148,163,184,0.7)',
  plugins: {
    legend: { labels: { color: '#94a3b8', font: { size: 11 } } }
  },
  scales: {
    x: { ticks: { color: '#64748b', font: { size: 10 } }, grid: { color: 'rgba(255,255,255,0.04)' } },
    y: { ticks: { color: '#64748b', font: { size: 10 } }, grid: { color: 'rgba(255,255,255,0.04)' } }
  }
};

let stockPieChartInstance = null;

function initCharts() {
  // Revenue chart
  new Chart(document.getElementById('revenueChart'), {
    type: 'bar',
    data: {
      labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
      datasets: [{
        data: [8200,9400,11200,10800,13400,12600,18657,14200,15800,13900,16200,15400],
        backgroundColor: 'rgba(27,187,126,0.3)',
        borderColor: '#1bbb7e',
        borderWidth: 2,
        borderRadius: 8,
        hoverBackgroundColor: 'rgba(27,187,126,0.6)',
      }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'#64748b',font:{size:10}},grid:{color:'rgba(255,255,255,0.04)'}},y:{ticks:{color:'#64748b',font:{size:10},callback:v=>'‚Ç¨'+v.toLocaleString()},grid:{color:'rgba(255,255,255,0.04)'}}}}
  });

  // Stock pie
  const stockVals = PRODUCTS.map(p => stockData[p.id]);
  const high = stockVals.filter(v => v >= 40).length;
  const med = stockVals.filter(v => v >= 20 && v < 40).length;
  const low = stockVals.filter(v => v < 20).length;
  stockPieChartInstance = new Chart(document.getElementById('stockPieChart'), {
    type: 'doughnut',
    data: {
      labels: ['High Stock (40+)', 'Medium (20-40)', 'Low (<20)'],
      datasets: [{
        data: [high, med, low],
        backgroundColor: ['rgba(27,187,126,0.7)','rgba(251,191,36,0.7)','rgba(239,68,68,0.7)'],
        borderColor: ['#1bbb7e','#fbbf24','#ef4444'],
        borderWidth: 2,
      }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{labels:{color:'#94a3b8',font:{size:11}},position:'bottom'}}}
  });

  // Price chart
  const priceRanges = {'‚Ç¨0-10':0,'‚Ç¨10-20':0,'‚Ç¨20-30':0,'‚Ç¨30-50':0,'‚Ç¨50+':0};
  PRODUCTS.forEach(p => {
    if(p.price <= 10) priceRanges['‚Ç¨0-10']++;
    else if(p.price <= 20) priceRanges['‚Ç¨10-20']++;
    else if(p.price <= 30) priceRanges['‚Ç¨20-30']++;
    else if(p.price <= 50) priceRanges['‚Ç¨30-50']++;
    else priceRanges['‚Ç¨50+']++;
  });
  new Chart(document.getElementById('priceChart'), {
    type: 'bar',
    data: {
      labels: Object.keys(priceRanges),
      datasets: [{
        data: Object.values(priceRanges),
        backgroundColor: ['rgba(59,130,246,0.5)','rgba(139,92,246,0.5)','rgba(27,187,126,0.5)','rgba(251,191,36,0.5)','rgba(239,68,68,0.5)'],
        borderColor: ['#3b82f6','#8b5cf6','#1bbb7e','#fbbf24','#ef4444'],
        borderWidth: 2,
        borderRadius: 6,
      }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'#64748b',font:{size:11}},grid:{display:false}},y:{ticks:{color:'#64748b',font:{size:10}},grid:{color:'rgba(255,255,255,0.04)'}}}}
  });
}

function updateStockPieChart() {
  if(!stockPieChartInstance) return;
  const stockVals = PRODUCTS.map(p => stockData[p.id]);
  stockPieChartInstance.data.datasets[0].data = [
    stockVals.filter(v => v >= 40).length,
    stockVals.filter(v => v >= 20 && v < 40).length,
    stockVals.filter(v => v < 20).length
  ];
  stockPieChartInstance.update();
}

function initAnalyticsCharts() {
  if(document.getElementById('analyticsRevChart').getAttribute('data-init')) return;
  document.getElementById('analyticsRevChart').setAttribute('data-init','1');

  new Chart(document.getElementById('analyticsRevChart'), {
    type: 'line',
    data: {
      labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
      datasets: [{
        label:'Revenue (‚Ç¨)',
        data: [6200,7800,9100,8600,11200,10400,16800,12900,14200,12100,15100,14200],
        borderColor:'#1bbb7e',backgroundColor:'rgba(27,187,126,0.1)',tension:0.4,fill:true,pointBackgroundColor:'#1bbb7e',pointRadius:4,
      }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{labels:{color:'#94a3b8'}}}, scales:{x:{ticks:{color:'#64748b'},grid:{color:'rgba(255,255,255,0.04)'}},y:{ticks:{color:'#64748b',callback:v=>'‚Ç¨'+v},grid:{color:'rgba(255,255,255,0.04)'}}}}
  });

  const mCount = CUSTOMERS.filter(c => c.gender === 'M').length;
  const fCount = CUSTOMERS.filter(c => c.gender === 'F').length;
  new Chart(document.getElementById('genderChart'), {
    type: 'pie',
    data: {
      labels: ['Male','Female'],
      datasets: [{ data:[mCount,fCount], backgroundColor:['rgba(59,130,246,0.7)','rgba(236,72,153,0.7)'],borderColor:['#3b82f6','#ec4899'],borderWidth:2 }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{labels:{color:'#94a3b8'},position:'bottom'}}}
  });

  const ageBuckets = {'18-30':0,'31-40':0,'41-50':0,'51-60':0,'61-70':0,'71+':0};
  CUSTOMERS.forEach(c => {
    if(c.age <= 30) ageBuckets['18-30']++;
    else if(c.age <= 40) ageBuckets['31-40']++;
    else if(c.age <= 50) ageBuckets['41-50']++;
    else if(c.age <= 60) ageBuckets['51-60']++;
    else if(c.age <= 70) ageBuckets['61-70']++;
    else ageBuckets['71+']++;
  });
  new Chart(document.getElementById('ageChart'), {
    type: 'bar',
    data: {
      labels: Object.keys(ageBuckets),
      datasets: [{ data:Object.values(ageBuckets), backgroundColor:'rgba(139,92,246,0.5)',borderColor:'#8b5cf6',borderWidth:2,borderRadius:6 }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'#64748b'},grid:{display:false}},y:{ticks:{color:'#64748b'},grid:{color:'rgba(255,255,255,0.04)'}}}}
  });

  const dosages = {};
  CUSTOMERS.forEach(c => { dosages[c.dosage] = (dosages[c.dosage]||0) + 1; });
  new Chart(document.getElementById('dosageChart'), {
    type: 'doughnut',
    data: {
      labels: Object.keys(dosages),
      datasets: [{ data:Object.values(dosages), backgroundColor:['rgba(27,187,126,0.6)','rgba(59,130,246,0.6)','rgba(251,191,36,0.6)','rgba(239,68,68,0.6)','rgba(139,92,246,0.6)'],borderWidth:2 }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{labels:{color:'#94a3b8',font:{size:10}},position:'right'}}}
  });

  // Top 10 products by revenue from customers
  const prodRevenue = {};
  CUSTOMERS.forEach(c => {
    const short = c.product.substring(0,20);
    prodRevenue[short] = (prodRevenue[short]||0) + c.price;
  });
  const sorted = Object.entries(prodRevenue).sort((a,b)=>b[1]-a[1]).slice(0,10);
  new Chart(document.getElementById('topProdChart'), {
    type: 'bar',
    data: {
      labels: sorted.map(s=>s[0]),
      datasets: [{ data:sorted.map(s=>s[1].toFixed(2)), backgroundColor:'rgba(27,187,126,0.4)',borderColor:'#1bbb7e',borderWidth:2,borderRadius:8 }]
    },
    options: { indexAxis:'y', responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{ticks:{color:'#64748b',callback:v=>'‚Ç¨'+v},grid:{color:'rgba(255,255,255,0.04)'}},y:{ticks:{color:'#94a3b8',font:{size:11}},grid:{display:false}}}}
  });
}

// ===== HEATMAP =====
function generateHeatmap() {
  const grid = document.getElementById('heatmapGrid');
  if(!grid) return;
  const levels = ['','h1','h2','h3','h4','h5'];
  const cells = Array.from({length:28}, () => levels[Math.floor(Math.random() * levels.length)]);
  const times = ['9am','10am','11am','12pm','1pm','2pm','3pm','4pm'];
  // Add time labels
  grid.innerHTML = '';
  // Add 4 rows of 7 (days x timeslots)
  for(let row = 0; row < 4; row++) {
    for(let col = 0; col < 7; col++) {
      const val = Math.floor(Math.random() * 6);
      const cell = document.createElement('div');
      cell.className = 'heatmap-cell ' + levels[val];
      cell.title = `Orders: ${val * 8 + Math.floor(Math.random()*8)}`;
      grid.appendChild(cell);
    }
  }
}

// ===== SCROLL REVEAL =====
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if(e.isIntersecting) {
      e.target.classList.add('visible');
      if(e.target.classList.contains('glow-on-scroll')) {
        setTimeout(() => e.target.classList.add('glowing'), 100);
        setTimeout(() => e.target.classList.remove('glowing'), 1100);
      }
    }
  });
}, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

// Init dashboard on load
initDashboard();

/*************************************************
 * BACKEND + AI AGENT ENDPOINT LAYER (ADD ONLY)
 * Paste this at the TOP of your main <script> tag
 *************************************************/

// NOTE:
// Ye assume karta hai ki tere existing code me:
// inventory, orders, alerts arrays already defined hain.
// Agar variable names different ho, bas yaha naam match kar dena.

window.API = {

  // ================= GET INVENTORY =================
  getInventory: async () => {
    return JSON.parse(JSON.stringify(inventory));
  },

  // ================= PLACE ORDER =================
  placeOrder: async (order) => {
    order.id = Date.now();
    orders.push(order);

    order.items.forEach(item => {
      const product = inventory.find(p => p.id === item.id);
      if (product) {
        product.stock -= item.qty;

        if (product.stock < 10) {
          alerts.push({
            id: Date.now(),
            message: `${product.name} stock low`,
            stock: product.stock
          });
        }
      }
    });

    return {
      success: true,
      orderId: order.id,
      message: "Order placed successfully"
    };
  },

  // ================= UPDATE STOCK =================
  updateStock: async (id, stock) => {
    const product = inventory.find(p => p.id === id);
    if (!product) {
      return { success: false, message: "Item not found" };
    }

    product.stock = stock;
    return { success: true, message: "Stock updated" };
  },

  // ================= GET ALERTS =================
  getAlerts: async () => {
    return alerts;
  }

};


// ================= AI AGENT ENDPOINT =================

window.AI_AGENT = async () => {

  const lowStockItems = inventory.filter(i => i.stock < 10);

  const salesMap = orders
    .flatMap(o => o.items)
    .reduce((acc, item) => {
      acc[item.id] = (acc[item.id] || 0) + item.qty;
      return acc;
    }, {});

  const fastMovingItems = Object.entries(salesMap)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);

  return {
    totalProducts: inventory.length,
    totalOrders: orders.length,
    lowStockItems,
    fastMovingItems
  };
};

/*************************************************
 * END OF BACKEND + AI AGENT LAYER
 *************************************************/
</script>
</body>
</html>
